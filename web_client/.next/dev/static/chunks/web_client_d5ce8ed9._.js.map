{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User01/.gemini/antigravity/scratch/renovation-next/web_client/lib/utils.ts"],"sourcesContent":["import { type ClassValue, clsx } from \"clsx\";\r\nimport { twMerge } from \"tailwind-merge\";\r\n\r\nexport function cn(...inputs: ClassValue[]) {\r\n    return twMerge(clsx(inputs));\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACtC,OAAO,IAAA,yKAAO,EAAC,IAAA,gJAAI,EAAC;AACxB"}},
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User01/.gemini/antigravity/scratch/renovation-next/web_client/components/ui/button.tsx"],"sourcesContent":["import * as React from \"react\"\r\nimport { Slot } from \"@radix-ui/react-slot\"\r\nimport { cva, type VariantProps } from \"class-variance-authority\"\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst buttonVariants = cva(\r\n    \"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 cursor-pointer\",\r\n    {\r\n        variants: {\r\n            variant: {\r\n                default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\r\n                destructive:\r\n                    \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\r\n                outline:\r\n                    \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\r\n                secondary:\r\n                    \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\r\n                ghost: \"hover:bg-accent hover:text-accent-foreground\",\r\n                link: \"text-primary underline-offset-4 hover:underline\",\r\n                premium: \"bg-gradient-to-r from-blue-600 to-cyan-500 text-white shadow-lg hover:shadow-cyan-500/25 hover:scale-[1.02] transition-all duration-300 border-0\",\r\n            },\r\n            size: {\r\n                default: \"h-10 px-4 py-2\",\r\n                sm: \"h-9 rounded-md px-3\",\r\n                lg: \"h-11 rounded-md px-8\",\r\n                icon: \"h-10 w-10\",\r\n            },\r\n        },\r\n        defaultVariants: {\r\n            variant: \"default\",\r\n            size: \"default\",\r\n        },\r\n    }\r\n)\r\n\r\nexport interface ButtonProps\r\n    extends React.ButtonHTMLAttributes<HTMLButtonElement>,\r\n    VariantProps<typeof buttonVariants> {\r\n    asChild?: boolean\r\n}\r\n\r\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\r\n    ({ className, variant, size, asChild = false, ...props }, ref) => {\r\n        const Comp = asChild ? Slot : \"button\"\r\n        return (\r\n            <Comp\r\n                className={cn(buttonVariants({ variant, size, className }))}\r\n                ref={ref}\r\n                {...props}\r\n            />\r\n        )\r\n    }\r\n)\r\nButton.displayName = \"Button\"\r\n\r\nexport { Button, buttonVariants }\r\n"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;;;;;;AAEA,MAAM,iBAAiB,IAAA,0KAAG,EACtB,ySACA;IACI,UAAU;QACN,SAAS;YACL,SAAS;YACT,aACI;YACJ,SACI;YACJ,WACI;YACJ,OAAO;YACP,MAAM;YACN,SAAS;QACb;QACA,MAAM;YACF,SAAS;YACT,IAAI;YACJ,IAAI;YACJ,MAAM;QACV;IACJ;IACA,iBAAiB;QACb,SAAS;QACT,MAAM;IACV;AACJ;AASJ,MAAM,uBAAS,2KAAgB,MAC3B,CAAC,EAAE,SAAS,EAAE,OAAO,EAAE,IAAI,EAAE,UAAU,KAAK,EAAE,GAAG,OAAO,EAAE;IACtD,MAAM,OAAO,UAAU,2KAAI,GAAG;IAC9B,qBACI,6LAAC;QACG,WAAW,IAAA,mIAAE,EAAC,eAAe;YAAE;YAAS;YAAM;QAAU;QACxD,KAAK;QACJ,GAAG,KAAK;;;;;;AAGrB;;AAEJ,OAAO,WAAW,GAAG"}},
    {"offset": {"line": 90, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User01/.gemini/antigravity/scratch/renovation-next/web_client/components/sections/Navbar.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport Link from 'next/link';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { Menu, X, Hammer } from 'lucide-react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { cn } from '@/lib/utils';\r\n\r\nexport function Navbar() {\r\n    const [isScrolled, setIsScrolled] = useState(false);\r\n    const [mobileMenuOpen, setMobileMenuOpen] = useState(false);\r\n\r\n    useEffect(() => {\r\n        const handleScroll = () => {\r\n            setIsScrolled(window.scrollY > 20);\r\n        };\r\n        window.addEventListener('scroll', handleScroll);\r\n        return () => window.removeEventListener('scroll', handleScroll);\r\n    }, []);\r\n\r\n    const navLinks = [\r\n        { name: 'Servizi', href: '#services' },\r\n        { name: 'Progetti', href: '#portfolio' },\r\n        { name: 'Chi Siamo', href: '#about' },\r\n        { name: 'FAQ', href: '#faq' },\r\n    ];\r\n\r\n    return (\r\n        <>\r\n            <motion.nav\r\n                className={cn(\r\n                    'fixed top-0 left-0 right-0 z-50 transition-all duration-300 border-b border-transparent',\r\n                    isScrolled\r\n                        ? 'bg-slate-950/80 backdrop-blur-md border-slate-800 py-3'\r\n                        : 'bg-transparent py-5'\r\n                )}\r\n                initial={{ y: -100 }}\r\n                animate={{ y: 0 }}\r\n                transition={{ duration: 0.5 }}\r\n            >\r\n                <div className=\"container mx-auto px-4 md:px-6 flex items-center justify-between\">\r\n                    <Link href=\"/\" className=\"flex items-center gap-2 group\">\r\n                        <div className=\"bg-gradient-to-br from-blue-600 to-cyan-500 p-2 rounded-lg group-hover:shadow-[0_0_20px_rgba(59,130,246,0.5)] transition-all duration-300\">\r\n                            <Hammer className=\"w-5 h-5 text-white\" />\r\n                        </div>\r\n                        <span className=\"text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-slate-400\">\r\n                            Renovation<span className=\"font-light\">AI</span>\r\n                        </span>\r\n                    </Link>\r\n\r\n                    {/* Desktop Nav */}\r\n                    <div className=\"hidden md:flex items-center gap-8\">\r\n                        {navLinks.map((link) => (\r\n                            <Link\r\n                                key={link.name}\r\n                                href={link.href}\r\n                                className=\"text-sm font-medium text-slate-300 hover:text-white transition-colors relative group\"\r\n                            >\r\n                                {link.name}\r\n                                <span className=\"absolute -bottom-1 left-0 w-0 h-0.5 bg-blue-500 transition-all group-hover:w-full\" />\r\n                            </Link>\r\n                        ))}\r\n                        <Button variant=\"premium\" size=\"sm\">\r\n                            Richiedi Preventivo\r\n                        </Button>\r\n                    </div>\r\n\r\n                    {/* Mobile Menu Toggle */}\r\n                    <button\r\n                        className=\"md:hidden text-slate-300 hover:text-white\"\r\n                        onClick={() => setMobileMenuOpen(true)}\r\n                    >\r\n                        <Menu />\r\n                    </button>\r\n                </div>\r\n            </motion.nav>\r\n\r\n            {/* Mobile Menu Overlay */}\r\n            <AnimatePresence>\r\n                {mobileMenuOpen && (\r\n                    <motion.div\r\n                        initial={{ opacity: 0, x: '100%' }}\r\n                        animate={{ opacity: 1, x: 0 }}\r\n                        exit={{ opacity: 0, x: '100%' }}\r\n                        transition={{ type: \"spring\", damping: 25, stiffness: 200 }}\r\n                        className=\"fixed inset-0 z-[60] bg-slate-950 flex flex-col p-6 md:hidden\"\r\n                    >\r\n                        <div className=\"flex justify-between items-center mb-10\">\r\n                            <span className=\"text-xl font-bold text-white\">Menu</span>\r\n                            <button\r\n                                onClick={() => setMobileMenuOpen(false)}\r\n                                className=\"p-2 bg-slate-900 rounded-full text-slate-400 hover:text-white\"\r\n                            >\r\n                                <X />\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div className=\"flex flex-col gap-6\">\r\n                            {navLinks.map((link, idx) => (\r\n                                <motion.a\r\n                                    key={link.name}\r\n                                    href={link.href}\r\n                                    className=\"text-2xl font-semibold text-slate-300 hover:text-white\"\r\n                                    initial={{ opacity: 0, x: 20 }}\r\n                                    animate={{ opacity: 1, x: 0 }}\r\n                                    transition={{ delay: 0.1 + idx * 0.1 }}\r\n                                    onClick={() => setMobileMenuOpen(false)}\r\n                                >\r\n                                    {link.name}\r\n                                </motion.a>\r\n                            ))}\r\n                            <motion.div\r\n                                initial={{ opacity: 0, y: 20 }}\r\n                                animate={{ opacity: 1, y: 0 }}\r\n                                transition={{ delay: 0.5 }}\r\n                                className=\"mt-8\"\r\n                            >\r\n                                <Button variant=\"premium\" className=\"w-full py-6 text-lg\">\r\n                                    Inizia Progetto\r\n                                </Button>\r\n                            </motion.div>\r\n                        </div>\r\n                    </motion.div>\r\n                )}\r\n            </AnimatePresence>\r\n        </>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 399, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User01/.gemini/antigravity/scratch/renovation-next/web_client/components/sections/Hero.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { motion } from 'framer-motion';\r\nimport { Button } from '@/components/ui/button';\r\nimport { ArrowRight, PlayCircle, Star, ShieldCheck, Zap } from 'lucide-react';\r\n\r\nexport function Hero() {\r\n    return (\r\n        <section className=\"relative min-h-screen flex items-center pt-20 overflow-hidden\">\r\n            {/* Background Elements */}\r\n            <div className=\"absolute inset-0 bg-slate-950 z-0\" />\r\n            <div className=\"absolute inset-0 bg-[#020617] bg-[radial-gradient(#1e293b_1px,transparent_1px)] [background-size:40px_40px] opacity-20 z-0\" />\r\n            <div className=\"absolute top-0 right-0 w-[500px] h-[500px] bg-blue-600/20 rounded-full blur-[120px] -translate-y-1/2 translate-x-1/2\" />\r\n            <div className=\"absolute bottom-0 left-0 w-[500px] h-[500px] bg-cyan-600/10 rounded-full blur-[120px] translate-y-1/2 -translate-x-1/2\" />\r\n\r\n            <div className=\"container mx-auto px-4 md:px-6 relative z-10 grid lg:grid-cols-2 gap-12 items-center\">\r\n\r\n                {/* Text Content */}\r\n                <motion.div\r\n                    initial={{ opacity: 0, y: 30 }}\r\n                    animate={{ opacity: 1, y: 0 }}\r\n                    transition={{ duration: 0.8 }}\r\n                >\r\n                    <div className=\"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-blue-900/30 border border-blue-500/30 text-blue-300 text-xs font-semibold uppercase tracking-wider mb-6\">\r\n                        <span className=\"relative flex h-2 w-2\">\r\n                            <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75\"></span>\r\n                            <span className=\"relative inline-flex rounded-full h-2 w-2 bg-blue-500\"></span>\r\n                        </span>\r\n                        La Nuova Era della Ristrutturazione\r\n                    </div>\r\n\r\n                    <h1 className=\"text-4xl md:text-6xl lg:text-7xl font-bold tracking-tight text-white leading-[1.1] mb-6\">\r\n                        Progetta la <br />\r\n                        <span className=\"text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-cyan-400 to-teal-400\">\r\n                            Casa dei Sogni\r\n                        </span>\r\n                        <br /> con l'AI.\r\n                    </h1>\r\n\r\n                    <p className=\"text-lg md:text-xl text-slate-400 mb-8 max-w-xl leading-relaxed\">\r\n                        Dall'idea alla realtà in pochi click. Ottieni preventivi istantanei, visualizzazioni 3D fotorealistiche e un team di esperti pronto a realizzare il tuo progetto.\r\n                    </p>\r\n\r\n                    <div className=\"flex flex-col sm:flex-row gap-4 mb-12\">\r\n                        <Button\r\n                            variant=\"premium\"\r\n                            size=\"lg\"\r\n                            className=\"h-14 px-8 text-base\"\r\n                            onClick={() => {\r\n                                const event = new CustomEvent('OPEN_CHAT_WITH_MESSAGE', {\r\n                                    detail: { message: \"Vorrei richiedere un preventivo gratuito per la mia ristrutturazione.\" }\r\n                                });\r\n                                window.dispatchEvent(event);\r\n                            }}\r\n                        >\r\n                            Richiedi Preventivo Gratuito\r\n                            <ArrowRight className=\"ml-2 w-5 h-5\" />\r\n                        </Button>\r\n                        <Button variant=\"outline\" size=\"lg\" className=\"h-14 px-8 text-base border-slate-700 hover:bg-slate-800 text-slate-300\">\r\n                            <PlayCircle className=\"mr-2 w-5 h-5\" />\r\n                            Guarda come funziona\r\n                        </Button>\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-3 gap-6 border-t border-white/5 pt-8\">\r\n                        <div className=\"flex flex-col gap-1\">\r\n                            <h4 className=\"text-2xl font-bold text-white\">100+</h4>\r\n                            <p className=\"text-sm text-slate-500\">Progetti Completati</p>\r\n                        </div>\r\n                        <div className=\"flex flex-col gap-1\">\r\n                            <h4 className=\"text-2xl font-bold text-white\">24h</h4>\r\n                            <p className=\"text-sm text-slate-500\">Tempo Preventivo</p>\r\n                        </div>\r\n                        <div className=\"flex flex-col gap-1\">\r\n                            <h4 className=\"text-2xl font-bold text-white\">4.9/5</h4>\r\n                            <p className=\"text-sm text-slate-500\">Soddisfazione Clienti</p>\r\n                        </div>\r\n                    </div>\r\n                </motion.div>\r\n\r\n                {/* Visual Content - Dashboard Preview */}\r\n                <motion.div\r\n                    initial={{ opacity: 0, x: 30 }}\r\n                    animate={{ opacity: 1, x: 0 }}\r\n                    transition={{ duration: 0.8, delay: 0.2 }}\r\n                    className=\"relative\"\r\n                >\r\n                    <div className=\"relative rounded-2xl overflow-hidden border border-slate-800 bg-slate-900/50 shadow-2xl shadow-blue-900/20 backdrop-blur-sm group\">\r\n                        {/* Fake UI Header */}\r\n                        <div className=\"flex items-center gap-2 px-4 py-3 border-b border-white/5 bg-slate-900/80\">\r\n                            <div className=\"w-3 h-3 rounded-full bg-red-500/50\" />\r\n                            <div className=\"w-3 h-3 rounded-full bg-yellow-500/50\" />\r\n                            <div className=\"w-3 h-3 rounded-full bg-green-500/50\" />\r\n                            <div className=\"ml-4 w-60 h-6 rounded-full bg-slate-800/50\" />\r\n                        </div>\r\n\r\n                        {/* Content Area - Clickable to trigger rendering */}\r\n                        <div\r\n                            className=\"p-1 min-h-[400px] relative bg-slate-950 cursor-pointer transition-all hover:ring-2 hover:ring-blue-500/50\"\r\n                            onClick={() => {\r\n                                const event = new CustomEvent('OPEN_CHAT_WITH_MESSAGE', {\r\n                                    detail: { message: \"Vorrei vedere un rendering 3D della mia idea.\" }\r\n                                });\r\n                                window.dispatchEvent(event);\r\n                            }}\r\n                            title=\"Clicca per iniziare la visualizzazione AI\"\r\n                        >\r\n                            <div className=\"absolute inset-0 bg-gradient-to-br from-slate-900 to-slate-800 flex items-center justify-center\">\r\n                                <div className=\"text-center\">\r\n                                    <div className=\"w-20 h-20 mx-auto bg-blue-500/10 rounded-full flex items-center justify-center mb-4\">\r\n                                        <Zap className=\"w-10 h-10 text-blue-400\" />\r\n                                    </div>\r\n                                    <p className=\"text-slate-500 font-mono text-sm\">AI Visualization Engine</p>\r\n                                    <p className=\"text-slate-600 text-xs mt-2\">Clicca per generare...</p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Floating Badges */}\r\n                            <motion.div\r\n                                animate={{ y: [0, -10, 0] }}\r\n                                transition={{ repeat: Infinity, duration: 4, ease: \"easeInOut\" }}\r\n                                className=\"absolute top-10 right-10 p-4 bg-slate-900/90 border border-slate-700/50 rounded-xl shadow-xl backdrop-blur-md\"\r\n                            >\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <div className=\"p-2 bg-green-500/20 rounded-lg text-green-400\">\r\n                                        <ShieldCheck className=\"w-5 h-5\" />\r\n                                    </div>\r\n                                    <div>\r\n                                        <p className=\"text-xs text-slate-400\">Preventivo Garantito</p>\r\n                                        <p className=\"text-sm font-bold text-white\">€1.200 di risparmio</p>\r\n                                    </div>\r\n                                </div>\r\n                            </motion.div>\r\n\r\n                            <motion.div\r\n                                animate={{ y: [0, 10, 0] }}\r\n                                transition={{ repeat: Infinity, duration: 5, ease: \"easeInOut\", delay: 1 }}\r\n                                className=\"absolute bottom-10 left-10 p-4 bg-slate-900/90 border border-slate-700/50 rounded-xl shadow-xl backdrop-blur-md\"\r\n                            >\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <div className=\"p-2 bg-amber-500/20 rounded-lg text-amber-400\">\r\n                                        <Star className=\"w-5 h-5\" />\r\n                                    </div>\r\n                                    <div>\r\n                                        <p className=\"text-xs text-slate-400\">Design Score</p>\r\n                                        <p className=\"text-sm font-bold text-white\">98/100 Excellent</p>\r\n                                    </div>\r\n                                </div>\r\n                            </motion.div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Glow backing */}\r\n                    <div className=\"absolute -inset-1 bg-gradient-to-r from-blue-600 to-cyan-600 rounded-2xl blur opacity-20 -z-10\" />\r\n                </motion.div>\r\n            </div>\r\n        </section>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 973, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User01/.gemini/antigravity/scratch/renovation-next/web_client/components/sections/Services.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { motion } from 'framer-motion';\r\nimport {\r\n    Wand2,\r\n    Ruler,\r\n    LayoutDashboard,\r\n    Calculator,\r\n    HardHat,\r\n    Home\r\n} from 'lucide-react';\r\nimport { cn } from '@/lib/utils';\r\n\r\nconst services = [\r\n    {\r\n        icon: Wand2,\r\n        title: 'Design Generativo AI',\r\n        description: 'Genera centinaia di varianti di design per la tua casa in pochi secondi. Dal minimalismo moderno al classico, visualizza ogni stile prima di iniziare.',\r\n        gradient: 'from-purple-500/20 to-blue-500/20',\r\n        iconColor: 'text-purple-400'\r\n    },\r\n    {\r\n        icon: Ruler,\r\n        title: 'Rilievi Precisi',\r\n        description: 'Trasforma le foto del tuo smartphone in planimetrie CAD accurate. La nostra tecnologia elimina gli errori di misurazione manuale.',\r\n        gradient: 'from-blue-500/20 to-cyan-500/20',\r\n        iconColor: 'text-blue-400'\r\n    },\r\n    {\r\n        icon: Calculator,\r\n        title: 'Preventivi Istantanei',\r\n        description: 'Niente più attese di settimane. Ottieni una stima dettagliata dei costi in tempo reale, basata sui prezzi di mercato attuali e sui materiali scelti.',\r\n        gradient: 'from-cyan-500/20 to-teal-500/20',\r\n        iconColor: 'text-cyan-400'\r\n    },\r\n    {\r\n        icon: LayoutDashboard,\r\n        title: 'Gestione Dashboard',\r\n        description: 'Controlla ogni aspetto del cantiere dalla tua area personale: avanzamento lavori, documenti, fatture e comunicazioni con il team.',\r\n        gradient: 'from-teal-500/20 to-emerald-500/20',\r\n        iconColor: 'text-teal-400'\r\n    },\r\n    {\r\n        icon: HardHat,\r\n        title: 'Direzione Lavori',\r\n        description: 'I nostri architetti partner seguono il tuo cantiere passo dopo passo, garantendo che l\\'esecuzione rispecchi perfettamente il progetto approvato.',\r\n        gradient: 'from-emerald-500/20 to-green-500/20',\r\n        iconColor: 'text-emerald-400'\r\n    },\r\n    {\r\n        icon: Home,\r\n        title: 'Chiavi in Mano',\r\n        description: 'Rilassati e goditi il risultato. Gestiamo tutto noi, dalla burocrazia alle pulizie finali, consegnandoti una casa pronta da vivere.',\r\n        gradient: 'from-green-500/20 to-lime-500/20',\r\n        iconColor: 'text-green-400'\r\n    }\r\n];\r\n\r\nexport function Services() {\r\n    return (\r\n        <section id=\"services\" className=\"py-20 relative bg-slate-950\">\r\n\r\n            {/* Section Background Decoration */}\r\n            <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full h-full max-w-7xl opacity-30 pointer-events-none\">\r\n                <div className=\"absolute top-0 right-0 w-96 h-96 bg-blue-900/20 rounded-full blur-[100px]\" />\r\n                <div className=\"absolute bottom-0 left-0 w-96 h-96 bg-cyan-900/20 rounded-full blur-[100px]\" />\r\n            </div>\r\n\r\n            <div className=\"container mx-auto px-4 md:px-6 relative z-10\">\r\n\r\n                {/* Header */}\r\n                <div className=\"text-center max-w-3xl mx-auto mb-16\">\r\n                    <motion.h2\r\n                        initial={{ opacity: 0, y: 20 }}\r\n                        whileInView={{ opacity: 1, y: 0 }}\r\n                        viewport={{ once: true }}\r\n                        className=\"text-3xl md:text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-slate-400 mb-4\"\r\n                    >\r\n                        Tecnologia al servizio del Design\r\n                    </motion.h2>\r\n                    <motion.p\r\n                        initial={{ opacity: 0, y: 20 }}\r\n                        whileInView={{ opacity: 1, y: 0 }}\r\n                        viewport={{ once: true }}\r\n                        transition={{ delay: 0.2 }}\r\n                        className=\"text-slate-400 text-lg\"\r\n                    >\r\n                        Abbiamo reingegnerizzato il processo di ristrutturazione per renderlo semplice, trasparente e sorprendentemente veloce.\r\n                    </motion.p>\r\n                </div>\r\n\r\n                {/* Grid */}\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                    {services.map((service, index) => (\r\n                        <motion.div\r\n                            key={index}\r\n                            initial={{ opacity: 0, y: 20 }}\r\n                            whileInView={{ opacity: 1, y: 0 }}\r\n                            viewport={{ once: true }}\r\n                            transition={{ delay: index * 0.1 }}\r\n                            whileHover={{ y: -5 }}\r\n                            className=\"group relative p-6 rounded-2xl bg-slate-900/50 border border-white/5 hover:border-white/10 transition-all duration-300 backdrop-blur-sm\"\r\n                        >\r\n                            {/* Card Gradient Background on Hover */}\r\n                            <div className={cn(\r\n                                \"absolute inset-0 rounded-2xl bg-gradient-to-br opacity-0 group-hover:opacity-10 transition-opacity duration-500\",\r\n                                service.gradient\r\n                            )} />\r\n\r\n                            <div className=\"relative z-10\">\r\n                                <div className={cn(\r\n                                    \"w-12 h-12 rounded-lg flex items-center justify-center mb-4 bg-slate-800/50 group-hover:scale-110 transition-transform duration-300\",\r\n                                    service.iconColor\r\n                                )}>\r\n                                    <service.icon className=\"w-6 h-6\" />\r\n                                </div>\r\n\r\n                                <h3 className=\"text-xl font-semibold text-white mb-3 group-hover:text-blue-300 transition-colors\">\r\n                                    {service.title}\r\n                                </h3>\r\n\r\n                                <p className=\"text-slate-400 text-sm leading-relaxed group-hover:text-slate-300 transition-colors\">\r\n                                    {service.description}\r\n                                </p>\r\n                            </div>\r\n                        </motion.div>\r\n                    ))}\r\n                </div>\r\n\r\n            </div>\r\n        </section>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA;AAXA;;;;;AAaA,MAAM,WAAW;IACb;QACI,MAAM,2NAAK;QACX,OAAO;QACP,aAAa;QACb,UAAU;QACV,WAAW;IACf;IACA;QACI,MAAM,gNAAK;QACX,OAAO;QACP,aAAa;QACb,UAAU;QACV,WAAW;IACf;IACA;QACI,MAAM,+NAAU;QAChB,OAAO;QACP,aAAa;QACb,UAAU;QACV,WAAW;IACf;IACA;QACI,MAAM,kPAAe;QACrB,OAAO;QACP,aAAa;QACb,UAAU;QACV,WAAW;IACf;IACA;QACI,MAAM,0NAAO;QACb,OAAO;QACP,aAAa;QACb,UAAU;QACV,WAAW;IACf;IACA;QACI,MAAM,8MAAI;QACV,OAAO;QACP,aAAa;QACb,UAAU;QACV,WAAW;IACf;CACH;AAEM,SAAS;IACZ,qBACI,6LAAC;QAAQ,IAAG;QAAW,WAAU;;0BAG7B,6LAAC;gBAAI,WAAU;;kCACX,6LAAC;wBAAI,WAAU;;;;;;kCACf,6LAAC;wBAAI,WAAU;;;;;;;;;;;;0BAGnB,6LAAC;gBAAI,WAAU;;kCAGX,6LAAC;wBAAI,WAAU;;0CACX,6LAAC,uMAAM,CAAC,EAAE;gCACN,SAAS;oCAAE,SAAS;oCAAG,GAAG;gCAAG;gCAC7B,aAAa;oCAAE,SAAS;oCAAG,GAAG;gCAAE;gCAChC,UAAU;oCAAE,MAAM;gCAAK;gCACvB,WAAU;0CACb;;;;;;0CAGD,6LAAC,uMAAM,CAAC,CAAC;gCACL,SAAS;oCAAE,SAAS;oCAAG,GAAG;gCAAG;gCAC7B,aAAa;oCAAE,SAAS;oCAAG,GAAG;gCAAE;gCAChC,UAAU;oCAAE,MAAM;gCAAK;gCACvB,YAAY;oCAAE,OAAO;gCAAI;gCACzB,WAAU;0CACb;;;;;;;;;;;;kCAML,6LAAC;wBAAI,WAAU;kCACV,SAAS,GAAG,CAAC,CAAC,SAAS,sBACpB,6LAAC,uMAAM,CAAC,GAAG;gCAEP,SAAS;oCAAE,SAAS;oCAAG,GAAG;gCAAG;gCAC7B,aAAa;oCAAE,SAAS;oCAAG,GAAG;gCAAE;gCAChC,UAAU;oCAAE,MAAM;gCAAK;gCACvB,YAAY;oCAAE,OAAO,QAAQ;gCAAI;gCACjC,YAAY;oCAAE,GAAG,CAAC;gCAAE;gCACpB,WAAU;;kDAGV,6LAAC;wCAAI,WAAW,IAAA,mIAAE,EACd,mHACA,QAAQ,QAAQ;;;;;;kDAGpB,6LAAC;wCAAI,WAAU;;0DACX,6LAAC;gDAAI,WAAW,IAAA,mIAAE,EACd,sIACA,QAAQ,SAAS;0DAEjB,cAAA,6LAAC,QAAQ,IAAI;oDAAC,WAAU;;;;;;;;;;;0DAG5B,6LAAC;gDAAG,WAAU;0DACT,QAAQ,KAAK;;;;;;0DAGlB,6LAAC;gDAAE,WAAU;0DACR,QAAQ,WAAW;;;;;;;;;;;;;+BA3BvB;;;;;;;;;;;;;;;;;;;;;;AAqCjC;KA1EgB"}},
    {"offset": {"line": 1218, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User01/.gemini/antigravity/scratch/renovation-next/web_client/components/sections/Portfolio.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { ArrowUpRight, Search } from 'lucide-react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { cn } from '@/lib/utils';\r\nimport Image from 'next/image';\r\n\r\n// Placeholder content - In production these would be your generated AI renders\r\nconst projects = [\r\n    {\r\n        id: 1,\r\n        title: 'Villa Moderna',\r\n        category: 'Soggiorno',\r\n        location: 'Milano, City Life',\r\n        image: 'https://images.unsplash.com/photo-1600210492486-724fe5c67fb0?q=80&w=1974&auto=format&fit=crop',\r\n        description: 'Ristrutturazione completa di un penthous con vista panoramica. Stile minimalista con tocchi caldi in legno.',\r\n        stats: { area: '120 mq', duration: '3 mesi', budget: '€85k' }\r\n    },\r\n    {\r\n        id: 2,\r\n        title: 'Cucina Minimal',\r\n        category: 'Cucina',\r\n        location: 'Roma, Parioli',\r\n        image: 'https://images.unsplash.com/photo-1556911220-e15b29be8c8f?q=80&w=2070&auto=format&fit=crop',\r\n        description: 'Design open space con isola centrale in marmo Calacatta e illuminazione LED integrata.',\r\n        stats: { area: '45 mq', duration: '4 settimane', budget: '€32k' }\r\n    },\r\n    {\r\n        id: 3,\r\n        title: 'Luxury Spa',\r\n        category: 'Bagno',\r\n        location: 'Firenze, Centro',\r\n        image: 'https://images.unsplash.com/photo-1552321554-5fefe8c9ef14?q=80&w=1974&auto=format&fit=crop',\r\n        description: 'Trasformazione di un bagno padronale in una spa privata con vasca freestanding e finiture in pietra.',\r\n        stats: { area: '18 mq', duration: '3 settimane', budget: '€22k' }\r\n    },\r\n    {\r\n        id: 4,\r\n        title: 'Loft Industriale',\r\n        category: 'Intero Appartamento',\r\n        location: 'Torino, Docks',\r\n        image: 'https://images.unsplash.com/photo-1505691938895-1758d7feb511?q=80&w=2070&auto=format&fit=crop',\r\n        description: 'Recupero di uno spazio industriale convertito in loft residenziale. Soppalchi in ferro e mattoni a vista.',\r\n        stats: { area: '150 mq', duration: '5 mesi', budget: '€110k' }\r\n    },\r\n    {\r\n        id: 5,\r\n        title: 'Camera Zen',\r\n        category: 'Camera da letto',\r\n        location: 'Como, Vista lago',\r\n        image: 'https://images.unsplash.com/photo-1598928506311-c55ded91a20c?q=80&w=2070&auto=format&fit=crop',\r\n        description: 'Design ispirato al Japandi per una camera da letto che concilia il riposo. Toni neutri e materiali naturali.',\r\n        stats: { area: '25 mq', duration: '2 settimane', budget: '€15k' }\r\n    },\r\n    {\r\n        id: 6,\r\n        title: 'Home Office Tech',\r\n        category: 'Ufficio',\r\n        location: 'Milano, Isola',\r\n        image: 'https://images.unsplash.com/photo-1593640408182-31c70c8268f5?q=80&w=2042&auto=format&fit=crop',\r\n        description: 'Studio professionale domestico ottimizzato per lo smart working, con insonorizzazione e cablaggio avanzato.',\r\n        stats: { area: '20 mq', duration: '2 settimane', budget: '€12k' }\r\n    }\r\n];\r\n\r\nconst categories = ['Tutti', 'Soggiorno', 'Cucina', 'Bagno', 'Esterni'];\r\n\r\nexport function Portfolio() {\r\n    const [activeCategory, setActiveCategory] = useState('Tutti');\r\n    const [hoveredProject, setHoveredProject] = useState<number | null>(null);\r\n\r\n    const filteredProjects = activeCategory === 'Tutti'\r\n        ? projects\r\n        : projects.filter(p => p.category === activeCategory);\r\n\r\n    return (\r\n        <section id=\"portfolio\" className=\"py-24 bg-slate-950 relative overflow-hidden\">\r\n            <div className=\"container mx-auto px-4 md:px-6 relative z-10\">\r\n\r\n                <div className=\"flex flex-col md:flex-row md:items-end justify-between mb-12 gap-8\">\r\n                    <div>\r\n                        <h2 className=\"text-3xl md:text-5xl font-bold text-white mb-4\">\r\n                            I Nostri Progetti\r\n                        </h2>\r\n                        <p className=\"text-slate-400 max-w-lg text-lg\">\r\n                            Esplora una selezione delle nostre migliori ristrutturazioni. Ogni progetto è unico, proprio come chi lo abita.\r\n                        </p>\r\n                    </div>\r\n\r\n                    <div className=\"flex flex-wrap gap-2\">\r\n                        {categories.map((cat) => (\r\n                            <button\r\n                                key={cat}\r\n                                onClick={() => setActiveCategory(cat)}\r\n                                className={cn(\r\n                                    \"px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 border\",\r\n                                    activeCategory === cat\r\n                                        ? \"bg-white text-slate-950 border-white\"\r\n                                        : \"bg-transparent text-slate-400 border-slate-800 hover:border-slate-600 hover:text-white\"\r\n                                )}\r\n                            >\r\n                                {cat}\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n\r\n                <motion.div\r\n                    layout\r\n                    className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\"\r\n                >\r\n                    <AnimatePresence>\r\n                        {filteredProjects.map((project) => (\r\n                            <motion.div\r\n                                layout\r\n                                key={project.id}\r\n                                initial={{ opacity: 0, scale: 0.9 }}\r\n                                animate={{ opacity: 1, scale: 1 }}\r\n                                exit={{ opacity: 0, scale: 0.9 }}\r\n                                transition={{ duration: 0.3 }}\r\n                                className=\"group relative aspect-[4/5] rounded-2xl overflow-hidden cursor-pointer bg-slate-900\"\r\n                                onMouseEnter={() => setHoveredProject(project.id)}\r\n                                onMouseLeave={() => setHoveredProject(null)}\r\n                            >\r\n                                <Image\r\n                                    src={project.image}\r\n                                    alt={project.title}\r\n                                    fill\r\n                                    sizes=\"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw\"\r\n                                    className=\"object-cover transition-transform duration-700 group-hover:scale-110\"\r\n                                />\r\n\r\n                                {/* Overlay Gradient */}\r\n                                <div className=\"absolute inset-0 bg-gradient-to-t from-slate-950 via-slate-950/20 to-transparent opacity-60 group-hover:opacity-80 transition-opacity duration-500\" />\r\n\r\n                                {/* Content */}\r\n                                <div className=\"absolute inset-0 p-6 flex flex-col justify-end translate-y-4 group-hover:translate-y-0 transition-transform duration-300\">\r\n                                    <div className=\"relative z-20\">\r\n                                        <p className=\"text-blue-400 text-sm font-medium mb-2 transform -translate-y-4 opacity-0 group-hover:translate-y-0 group-hover:opacity-100 transition-all duration-300 delay-75\">\r\n                                            {project.category}\r\n                                        </p>\r\n\r\n                                        <h3 className=\"text-2xl font-bold text-white mb-2\">{project.title}</h3>\r\n\r\n                                        <p className=\"text-slate-300 text-sm line-clamp-2 max-h-0 opacity-0 group-hover:max-h-20 group-hover:opacity-100 transition-all duration-300 delay-100 mb-4\">\r\n                                            {project.description}\r\n                                        </p>\r\n\r\n                                        <div className=\"flex gap-4 border-t border-white/10 pt-4 mt-2 max-h-0 opacity-0 group-hover:max-h-20 group-hover:opacity-100 transition-all duration-300 delay-150\">\r\n                                            <div>\r\n                                                <p className=\"text-[10px] text-slate-500 uppercase tracking-wider\">Area</p>\r\n                                                <p className=\"text-xs text-white font-medium\">{project.stats.area}</p>\r\n                                            </div>\r\n                                            <div>\r\n                                                <p className=\"text-[10px] text-slate-500 uppercase tracking-wider\">Tempo</p>\r\n                                                <p className=\"text-xs text-white font-medium\">{project.stats.duration}</p>\r\n                                            </div>\r\n                                            <div>\r\n                                                <p className=\"text-[10px] text-slate-500 uppercase tracking-wider\">Budget</p>\r\n                                                <p className=\"text-xs text-white font-medium\">{project.stats.budget}</p>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Corner Button */}\r\n                                <div className=\"absolute top-4 right-4 z-20 opacity-0 group-hover:opacity-100 transition-opacity duration-300 delay-200\">\r\n                                    <div className=\"w-10 h-10 rounded-full bg-white/10 backdrop-blur-md flex items-center justify-center border border-white/20 text-white hover:bg-white hover:text-black transition-colors\">\r\n                                        <ArrowUpRight className=\"w-5 h-5\" />\r\n                                    </div>\r\n                                </div>\r\n                            </motion.div>\r\n                        ))}\r\n                    </AnimatePresence>\r\n                </motion.div>\r\n\r\n                <div className=\"mt-16 text-center\">\r\n                    <Button variant=\"outline\" size=\"lg\" className=\"px-8 border-slate-700 text-slate-300 hover:text-white hover:bg-slate-800\">\r\n                        Visualizza tutti i progetti\r\n                    </Button>\r\n                </div>\r\n\r\n            </div>\r\n        </section>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1628, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User01/.gemini/antigravity/scratch/renovation-next/web_client/components/sections/Testimonials.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { motion } from 'framer-motion';\r\nimport { Star, Quote } from 'lucide-react';\r\n\r\nconst testimonials = [\r\n    {\r\n        id: 1,\r\n        name: 'Marco Rossi',\r\n        role: 'Imprenditore',\r\n        location: 'Milano',\r\n        text: \"Ero scettico sull'uso dell'IA per una ristrutturazione, ma il livello di dettaglio dei render preliminari mi ha sbalordito. Abbiamo risparmiato settimane di indecisioni scelte sui materiali.\",\r\n        rating: 5,\r\n        initials: 'MR',\r\n        gradient: 'from-blue-500 to-cyan-500'\r\n    },\r\n    {\r\n        id: 2,\r\n        name: 'Sofia Bianchi',\r\n        role: 'Architetto',\r\n        location: 'Roma',\r\n        text: \"Come professionista, apprezzo la precisione dei rilievi e la facilità di gestione del cantiere tramite la dashboard. Un partner tecnologico, non solo un'impresa.\",\r\n        rating: 5,\r\n        initials: 'SB',\r\n        gradient: 'from-purple-500 to-pink-500'\r\n    },\r\n    {\r\n        id: 3,\r\n        name: 'Luca e Giulia',\r\n        role: 'Coppia',\r\n        location: 'Firenze',\r\n        text: \"Volevamo ristrutturare il nostro primo appartamento senza stress. Il preventivo è stato rispettato al centesimo e la consegna è avvenuta in anticipo. Incredibile.\",\r\n        rating: 5,\r\n        initials: 'LG',\r\n        gradient: 'from-amber-500 to-orange-500'\r\n    }\r\n];\r\n\r\nexport function Testimonials() {\r\n    return (\r\n        <section id=\"testimonials\" className=\"py-24 relative bg-slate-950 overflow-hidden\">\r\n\r\n            {/* Background Decor */}\r\n            <div className=\"absolute top-0 left-1/2 -translate-x-1/2 w-full max-w-7xl h-full pointer-events-none opacity-20\">\r\n                <div className=\"absolute top-1/4 left-1/4 w-64 h-64 bg-blue-600/20 rounded-full blur-[80px]\" />\r\n                <div className=\"absolute bottom-1/4 right-1/4 w-64 h-64 bg-cyan-600/20 rounded-full blur-[80px]\" />\r\n            </div>\r\n\r\n            <div className=\"container mx-auto px-4 md:px-6 relative z-10\">\r\n\r\n                <div className=\"text-center max-w-3xl mx-auto mb-16\">\r\n                    <motion.div\r\n                        initial={{ opacity: 0, scale: 0.9 }}\r\n                        whileInView={{ opacity: 1, scale: 1 }}\r\n                        viewport={{ once: true }}\r\n                        className=\"inline-flex items-center justify-center p-3 mb-6 bg-slate-900/50 rounded-full border border-white/5\"\r\n                    >\r\n                        <div className=\"flex gap-1 text-amber-400\">\r\n                            {[...Array(5)].map((_, i) => <Star key={i} className=\"w-4 h-4 fill-current\" />)}\r\n                        </div>\r\n                        <span className=\"ml-3 text-sm text-slate-300 font-medium\">Trusted by 500+ Homeowners</span>\r\n                    </motion.div>\r\n\r\n                    <motion.h2\r\n                        initial={{ opacity: 0, y: 20 }}\r\n                        whileInView={{ opacity: 1, y: 0 }}\r\n                        viewport={{ once: true }}\r\n                        className=\"text-3xl md:text-5xl font-bold text-white mb-6\"\r\n                    >\r\n                        Dicono di Noi\r\n                    </motion.h2>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8\">\r\n                    {testimonials.map((t, idx) => (\r\n                        <motion.div\r\n                            key={t.id}\r\n                            initial={{ opacity: 0, y: 30 }}\r\n                            whileInView={{ opacity: 1, y: 0 }}\r\n                            viewport={{ once: true }}\r\n                            transition={{ delay: idx * 0.1 }}\r\n                            className=\"relative p-8 rounded-3xl bg-gradient-to-br from-slate-900 via-slate-900 to-slate-800 border border-white/5 shadow-xl group hover:border-white/10 transition-colors\"\r\n                        >\r\n                            <Quote className=\"absolute top-8 right-8 w-12 h-12 text-slate-800 group-hover:text-slate-700 transition-colors\" />\r\n\r\n                            <div className=\"relative z-10\">\r\n                                <div className=\"flex items-center gap-4 mb-6\">\r\n                                    <div className={`w-14 h-14 rounded-full bg-gradient-to-br ${t.gradient} flex items-center justify-center text-white font-bold text-xl shadow-lg`}>\r\n                                        {t.initials}\r\n                                    </div>\r\n                                    <div>\r\n                                        <h4 className=\"text-white font-bold text-lg leading-tight\">{t.name}</h4>\r\n                                        <p className=\"text-slate-500 text-sm\">{t.role} • {t.location}</p>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"flex gap-1 text-amber-500 mb-4\">\r\n                                    {[...Array(t.rating)].map((_, i) => (\r\n                                        <Star key={i} className=\"w-4 h-4 fill-current\" />\r\n                                    ))}\r\n                                </div>\r\n\r\n                                <p className=\"text-slate-300 leading-relaxed italic\">\r\n                                    \"{t.text}\"\r\n                                </p>\r\n                            </div>\r\n                        </motion.div>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n        </section>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAHA;;;;AAKA,MAAM,eAAe;IACjB;QACI,IAAI;QACJ,MAAM;QACN,MAAM;QACN,UAAU;QACV,MAAM;QACN,QAAQ;QACR,UAAU;QACV,UAAU;IACd;IACA;QACI,IAAI;QACJ,MAAM;QACN,MAAM;QACN,UAAU;QACV,MAAM;QACN,QAAQ;QACR,UAAU;QACV,UAAU;IACd;IACA;QACI,IAAI;QACJ,MAAM;QACN,MAAM;QACN,UAAU;QACV,MAAM;QACN,QAAQ;QACR,UAAU;QACV,UAAU;IACd;CACH;AAEM,SAAS;IACZ,qBACI,6LAAC;QAAQ,IAAG;QAAe,WAAU;;0BAGjC,6LAAC;gBAAI,WAAU;;kCACX,6LAAC;wBAAI,WAAU;;;;;;kCACf,6LAAC;wBAAI,WAAU;;;;;;;;;;;;0BAGnB,6LAAC;gBAAI,WAAU;;kCAEX,6LAAC;wBAAI,WAAU;;0CACX,6LAAC,uMAAM,CAAC,GAAG;gCACP,SAAS;oCAAE,SAAS;oCAAG,OAAO;gCAAI;gCAClC,aAAa;oCAAE,SAAS;oCAAG,OAAO;gCAAE;gCACpC,UAAU;oCAAE,MAAM;gCAAK;gCACvB,WAAU;;kDAEV,6LAAC;wCAAI,WAAU;kDACV;+CAAI,MAAM;yCAAG,CAAC,GAAG,CAAC,CAAC,GAAG,kBAAM,6LAAC,6MAAI;gDAAS,WAAU;+CAAb;;;;;;;;;;kDAE5C,6LAAC;wCAAK,WAAU;kDAA0C;;;;;;;;;;;;0CAG9D,6LAAC,uMAAM,CAAC,EAAE;gCACN,SAAS;oCAAE,SAAS;oCAAG,GAAG;gCAAG;gCAC7B,aAAa;oCAAE,SAAS;oCAAG,GAAG;gCAAE;gCAChC,UAAU;oCAAE,MAAM;gCAAK;gCACvB,WAAU;0CACb;;;;;;;;;;;;kCAKL,6LAAC;wBAAI,WAAU;kCACV,aAAa,GAAG,CAAC,CAAC,GAAG,oBAClB,6LAAC,uMAAM,CAAC,GAAG;gCAEP,SAAS;oCAAE,SAAS;oCAAG,GAAG;gCAAG;gCAC7B,aAAa;oCAAE,SAAS;oCAAG,GAAG;gCAAE;gCAChC,UAAU;oCAAE,MAAM;gCAAK;gCACvB,YAAY;oCAAE,OAAO,MAAM;gCAAI;gCAC/B,WAAU;;kDAEV,6LAAC,gNAAK;wCAAC,WAAU;;;;;;kDAEjB,6LAAC;wCAAI,WAAU;;0DACX,6LAAC;gDAAI,WAAU;;kEACX,6LAAC;wDAAI,WAAW,CAAC,yCAAyC,EAAE,EAAE,QAAQ,CAAC,wEAAwE,CAAC;kEAC3I,EAAE,QAAQ;;;;;;kEAEf,6LAAC;;0EACG,6LAAC;gEAAG,WAAU;0EAA8C,EAAE,IAAI;;;;;;0EAClE,6LAAC;gEAAE,WAAU;;oEAA0B,EAAE,IAAI;oEAAC;oEAAI,EAAE,QAAQ;;;;;;;;;;;;;;;;;;;0DAIpE,6LAAC;gDAAI,WAAU;0DACV;uDAAI,MAAM,EAAE,MAAM;iDAAE,CAAC,GAAG,CAAC,CAAC,GAAG,kBAC1B,6LAAC,6MAAI;wDAAS,WAAU;uDAAb;;;;;;;;;;0DAInB,6LAAC;gDAAE,WAAU;;oDAAwC;oDAC/C,EAAE,IAAI;oDAAC;;;;;;;;;;;;;;+BA3BZ,EAAE,EAAE;;;;;;;;;;;;;;;;;;;;;;AAoCrC;KA1EgB"}},
    {"offset": {"line": 1917, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User01/.gemini/antigravity/scratch/renovation-next/web_client/components/sections/Footer.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState } from 'react';\r\nimport Link from 'next/link';\r\nimport { motion } from 'framer-motion';\r\nimport { Hammer, Facebook, Instagram, Linkedin, Twitter, Mail, MapPin, Phone, CheckCircle, XCircle } from 'lucide-react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { cn } from '@/lib/utils';\r\n\r\nexport function Footer() {\r\n    const currentYear = new Date().getFullYear();\r\n    const [email, setEmail] = useState('');\r\n    const [status, setStatus] = useState<'idle' | 'loading' | 'success' | 'error'>('idle');\r\n    const [message, setMessage] = useState('');\r\n\r\n    const sanitizeInput = (input: string) => {\r\n        // Basic sanitization to prevent XSS (though React renders text safely by default)\r\n        return input.replace(/[<>]/g, \"\").trim();\r\n    };\r\n\r\n    const handleSubscribe = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (status === 'loading') return;\r\n\r\n        const cleanEmail = sanitizeInput(email);\r\n        const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n\r\n        if (!emailRegex.test(cleanEmail)) {\r\n            setStatus('error');\r\n            setMessage('Inserisci un indirizzo email valido.');\r\n            return;\r\n        }\r\n\r\n        setStatus('loading');\r\n\r\n        // Simulate API call\r\n        setTimeout(() => {\r\n            // Here you would typically fetch to your API\r\n            setStatus('success');\r\n            setMessage('Grazie per l\\'iscrizione!');\r\n            setEmail('');\r\n\r\n            // Reset after 3 seconds\r\n            setTimeout(() => {\r\n                setStatus('idle');\r\n                setMessage('');\r\n            }, 3000);\r\n        }, 1500);\r\n    };\r\n\r\n    return (\r\n        <footer className=\"bg-[#020617] border-t border-white/5 pt-20 pb-10 relative overflow-hidden\">\r\n\r\n            {/* Decorative Glow */}\r\n            <div className=\"absolute bottom-0 left-0 w-full h-[500px] bg-gradient-to-t from-blue-900/10 to-transparent pointer-events-none\" />\r\n\r\n            <div className=\"container mx-auto px-4 md:px-6 relative z-10\">\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12 mb-16\">\r\n\r\n                    {/* Brand Column */}\r\n                    <div className=\"space-y-6\">\r\n                        <Link href=\"/\" className=\"flex items-center gap-2 group\">\r\n                            <div className=\"bg-gradient-to-br from-blue-600 to-cyan-500 p-2 rounded-lg\">\r\n                                <Hammer className=\"w-5 h-5 text-white\" />\r\n                            </div>\r\n                            <span className=\"text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-slate-400\">\r\n                                Renovation<span className=\"font-light\">AI</span>\r\n                            </span>\r\n                        </Link>\r\n                        <p className=\"text-slate-400 text-sm leading-relaxed max-w-xs\">\r\n                            Rivoluzioniamo il modo di progettare e ristrutturare casa. Tecnologia AI all'avanguardia per risultati garantiti e senza sorprese.\r\n                        </p>\r\n                        <div className=\"flex gap-4\">\r\n                            {[Facebook, Instagram, Linkedin, Twitter].map((Icon, i) => (\r\n                                <a\r\n                                    key={i}\r\n                                    href=\"#\"\r\n                                    className=\"w-10 h-10 rounded-full bg-slate-900 border border-white/10 flex items-center justify-center text-slate-400 hover:text-white hover:border-blue-500/50 hover:bg-blue-500/10 transition-all duration-300\"\r\n                                    aria-label={`Social Media Link ${i}`}\r\n                                >\r\n                                    <Icon className=\"w-4 h-4\" />\r\n                                </a>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Quick Links */}\r\n                    <div>\r\n                        <h4 className=\"text-white font-semibold mb-6\">Esplora</h4>\r\n                        <ul className=\"space-y-4\">\r\n                            {['Home', 'Servizi', 'Portfolio', 'Chi Siamo', 'Blog'].map((item) => (\r\n                                <li key={item}>\r\n                                    <Link href=\"#\" className=\"text-slate-400 hover:text-blue-400 transition-colors text-sm\">\r\n                                        {item}\r\n                                    </Link>\r\n                                </li>\r\n                            ))}\r\n                        </ul>\r\n                    </div>\r\n\r\n                    {/* Contact Info */}\r\n                    <div>\r\n                        <h4 className=\"text-white font-semibold mb-6\">Contatti</h4>\r\n                        <ul className=\"space-y-4\">\r\n                            <li className=\"flex items-start gap-3 text-slate-400 text-sm\">\r\n                                <MapPin className=\"w-5 h-5 text-blue-500 shrink-0\" />\r\n                                <span>Via dell'Innovazione 42,<br />20100 Milano (MI)</span>\r\n                            </li>\r\n                            <li className=\"flex items-center gap-3 text-slate-400 text-sm\">\r\n                                <Phone className=\"w-5 h-5 text-blue-500 shrink-0\" />\r\n                                <span>+39 02 123 4567</span>\r\n                            </li>\r\n                            <li className=\"flex items-center gap-3 text-slate-400 text-sm\">\r\n                                <Mail className=\"w-5 h-5 text-blue-500 shrink-0\" />\r\n                                <span>info@renovationai.it</span>\r\n                            </li>\r\n                        </ul>\r\n                    </div>\r\n\r\n                    {/* Newsletter */}\r\n                    <div>\r\n                        <h4 className=\"text-white font-semibold mb-6\">Newsletter</h4>\r\n                        <p className=\"text-slate-400 text-sm mb-4\">\r\n                            Iscriviti per ricevere consigli di design e offerte esclusive.\r\n                        </p>\r\n                        <form className=\"space-y-3\" onSubmit={handleSubscribe}>\r\n                            <div className=\"relative\">\r\n                                <input\r\n                                    type=\"email\"\r\n                                    value={email}\r\n                                    onChange={(e) => {\r\n                                        setEmail(e.target.value);\r\n                                        if (status === 'error') setStatus('idle');\r\n                                    }}\r\n                                    placeholder=\"La tua email\"\r\n                                    className={cn(\r\n                                        \"w-full bg-slate-900 border rounded-lg px-4 py-3 text-sm text-white focus:outline-none transition-colors\",\r\n                                        status === 'error' ? \"border-red-500 focus:border-red-500\" : \"border-white/10 focus:border-blue-500\"\r\n                                    )}\r\n                                    disabled={status === 'loading' || status === 'success'}\r\n                                    aria-label=\"Email address for newsletter\"\r\n                                />\r\n                            </div>\r\n\r\n                            <Button\r\n                                variant=\"premium\"\r\n                                className=\"w-full relative overflow-hidden\"\r\n                                disabled={status === 'loading' || status === 'success'}\r\n                            >\r\n                                {status === 'loading' ? (\r\n                                    <span className=\"flex items-center gap-2\">\r\n                                        <div className=\"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\r\n                                        Attendi...\r\n                                    </span>\r\n                                ) : status === 'success' ? (\r\n                                    <span className=\"flex items-center gap-2 text-white\">\r\n                                        <CheckCircle className=\"w-4 h-4\" />\r\n                                        Iscritto!\r\n                                    </span>\r\n                                ) : (\r\n                                    'Iscriviti'\r\n                                )}\r\n                            </Button>\r\n\r\n                            {status === 'error' && (\r\n                                <p className=\"text-xs text-red-400 flex items-center gap-1 animate-in fade-in slide-in-from-top-1\">\r\n                                    <XCircle className=\"w-3 h-3\" />\r\n                                    {message}\r\n                                </p>\r\n                            )}\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"border-t border-white/5 pt-8 flex flex-col md:flex-row justify-between items-center gap-4\">\r\n                    <p className=\"text-slate-500 text-sm\">\r\n                        © {currentYear} Renovation AI. Tutti i diritti riservati.\r\n                    </p>\r\n                    <div className=\"flex gap-6 text-sm text-slate-500\">\r\n                        <Link href=\"#\" className=\"hover:text-white transition-colors\">Privacy Policy</Link>\r\n                        <Link href=\"#\" className=\"hover:text-white transition-colors\">Termini di Servizio</Link>\r\n                        <Link href=\"#\" className=\"hover:text-white transition-colors\">Cookie Policy</Link>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </footer>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2430, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User01/.gemini/antigravity/scratch/renovation-next/web_client/hooks/useSessionId.ts"],"sourcesContent":["import { useState } from 'react';\r\n\r\n/**\r\n * Custom hook for managing chat session ID with localStorage persistence\r\n * Extracted from ChatWidget.tsx (lines 27-40)\r\n */\r\nexport function useSessionId() {\r\n    const [sessionId] = useState(() => {\r\n        if (typeof window === 'undefined') return `session-${Date.now()}`;\r\n\r\n        const stored = localStorage.getItem('chatSessionId');\r\n        if (stored) {\r\n            console.log('[SessionID] Restored from localStorage:', stored);\r\n            return stored;\r\n        }\r\n\r\n        const newSessionId = `session-${Date.now()}-${Math.random().toString(36).substring(7)}`;\r\n        localStorage.setItem('chatSessionId', newSessionId);\r\n        console.log('[SessionID] Created new session:', newSessionId);\r\n        return newSessionId;\r\n    });\r\n\r\n    return sessionId;\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;;AAMO,SAAS;;IACZ,MAAM,CAAC,UAAU,GAAG,IAAA,yKAAQ;iCAAC;YACzB;;YAEA,MAAM,SAAS,aAAa,OAAO,CAAC;YACpC,IAAI,QAAQ;gBACR,QAAQ,GAAG,CAAC,2CAA2C;gBACvD,OAAO;YACX;YAEA,MAAM,eAAe,CAAC,QAAQ,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,SAAS,CAAC,IAAI;YACvF,aAAa,OAAO,CAAC,iBAAiB;YACtC,QAAQ,GAAG,CAAC,oCAAoC;YAChD,OAAO;QACX;;IAEA,OAAO;AACX;GAjBgB"}},
    {"offset": {"line": 2464, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User01/.gemini/antigravity/scratch/renovation-next/web_client/hooks/useChatHistory.ts"],"sourcesContent":["import { useState, useEffect } from 'react';\r\n\r\ninterface Message {\r\n    id: string;\r\n    role: string;\r\n    content: string;\r\n}\r\n\r\n/**\r\n * Custom hook for loading chat history from Firestore\r\n * Extracted from ChatWidget.tsx (lines 47-87)\r\n */\r\nexport function useChatHistory(sessionId: string) {\r\n    const [historyLoaded, setHistoryLoaded] = useState(false);\r\n    const [historyMessages, setHistoryMessages] = useState<Message[]>([]);\r\n\r\n    useEffect(() => {\r\n        console.log(\"[useChatHistory] Initialized with sessionId:\", sessionId);\r\n\r\n        const loadHistory = async () => {\r\n            try {\r\n                console.log(\"[useChatHistory] Loading conversation history...\");\r\n                const response = await fetch(`/api/chat/history?sessionId=${sessionId}`);\r\n\r\n                if (response.ok) {\r\n                    const data = await response.json();\r\n\r\n                    if (data.messages && data.messages.length > 0) {\r\n                        console.log(`[useChatHistory] Loaded ${data.messages.length} messages from history`);\r\n\r\n                        const historyMessages = data.messages.map((msg: any, idx: number) => ({\r\n                            id: `history-${idx}`,\r\n                            role: msg.role,\r\n                            content: msg.content,\r\n                        }));\r\n\r\n                        setHistoryMessages(historyMessages);\r\n                    } else {\r\n                        console.log(\"[useChatHistory] No previous messages found - starting fresh\");\r\n                    }\r\n                } else {\r\n                    console.error(\"[useChatHistory] Failed to load history:\", response.status);\r\n                }\r\n\r\n                setHistoryLoaded(true);\r\n            } catch (error) {\r\n                console.error(\"[useChatHistory] Error loading history:\", error);\r\n                setHistoryLoaded(true);\r\n            }\r\n        };\r\n\r\n        loadHistory();\r\n    }, [sessionId]);\r\n\r\n    return { historyLoaded, historyMessages };\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;;AAYO,SAAS,eAAe,SAAiB;;IAC5C,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,yKAAQ,EAAC;IACnD,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,yKAAQ,EAAY,EAAE;IAEpE,IAAA,0KAAS;oCAAC;YACN,QAAQ,GAAG,CAAC,gDAAgD;YAE5D,MAAM;wDAAc;oBAChB,IAAI;wBACA,QAAQ,GAAG,CAAC;wBACZ,MAAM,WAAW,MAAM,MAAM,CAAC,4BAA4B,EAAE,WAAW;wBAEvE,IAAI,SAAS,EAAE,EAAE;4BACb,MAAM,OAAO,MAAM,SAAS,IAAI;4BAEhC,IAAI,KAAK,QAAQ,IAAI,KAAK,QAAQ,CAAC,MAAM,GAAG,GAAG;gCAC3C,QAAQ,GAAG,CAAC,CAAC,wBAAwB,EAAE,KAAK,QAAQ,CAAC,MAAM,CAAC,sBAAsB,CAAC;gCAEnF,MAAM,kBAAkB,KAAK,QAAQ,CAAC,GAAG;4FAAC,CAAC,KAAU,MAAgB,CAAC;4CAClE,IAAI,CAAC,QAAQ,EAAE,KAAK;4CACpB,MAAM,IAAI,IAAI;4CACd,SAAS,IAAI,OAAO;wCACxB,CAAC;;gCAED,mBAAmB;4BACvB,OAAO;gCACH,QAAQ,GAAG,CAAC;4BAChB;wBACJ,OAAO;4BACH,QAAQ,KAAK,CAAC,4CAA4C,SAAS,MAAM;wBAC7E;wBAEA,iBAAiB;oBACrB,EAAE,OAAO,OAAO;wBACZ,QAAQ,KAAK,CAAC,2CAA2C;wBACzD,iBAAiB;oBACrB;gBACJ;;YAEA;QACJ;mCAAG;QAAC;KAAU;IAEd,OAAO;QAAE;QAAe;IAAgB;AAC5C;GA3CgB"}},
    {"offset": {"line": 2526, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User01/.gemini/antigravity/scratch/renovation-next/web_client/hooks/useChat.ts"],"sourcesContent":["import { useState, useCallback, useRef, useEffect } from 'react';\r\nimport { v4 as uuidv4 } from 'uuid';\r\n\r\nexport type Message = {\r\n    id: string;\r\n    role: 'user' | 'assistant' | 'system' | 'data';\r\n    content: string;\r\n    parts?: any[];\r\n    toolInvocations?: ToolInvocation[];\r\n};\r\n\r\nexport interface ToolInvocation {\r\n    toolCallId: string;\r\n    toolName: string;\r\n    state: 'call' | 'result';\r\n    args?: any;\r\n    result?: any;\r\n}\r\n\r\nexport function useChat(sessionId: string, initialMessages: any[] = []) {\r\n    const [messages, setMessages] = useState<Message[]>(initialMessages);\r\n    const [input, setInput] = useState('');\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [error, setError] = useState<Error | undefined>(undefined);\r\n    const abortControllerRef = useRef<AbortController | null>(null);\r\n\r\n    // ✅ Load history on mount\r\n    useEffect(() => {\r\n        if (!sessionId || initialMessages.length > 0) return;\r\n\r\n        const fetchHistory = async () => {\r\n            try {\r\n                const res = await fetch(`/api/chat/history?sessionId=${sessionId}`);\r\n                if (!res.ok) throw new Error('Failed to load history');\r\n\r\n                const data = await res.json();\r\n                if (data.messages && Array.isArray(data.messages)) {\r\n                    setMessages(data.messages);\r\n                }\r\n            } catch (err) {\r\n                console.error('[useChat] Failed to load history:', err);\r\n            }\r\n        };\r\n\r\n        fetchHistory();\r\n    }, [sessionId, initialMessages.length]);\r\n\r\n    const handleInputChange = (e: any) => {\r\n        setInput(e.target.value);\r\n    };\r\n\r\n    const append = useCallback(async (\r\n        message: { role: string; content: string },\r\n        options?: { body?: { images?: string[]; imageUrls?: string[] } }\r\n    ) => {\r\n        setIsLoading(true);\r\n        setError(undefined);\r\n\r\n        // Add user message immediately (Optimistic UI)\r\n        const userMsgId = uuidv4();\r\n        const userMsg: Message = {\r\n            id: userMsgId,\r\n            role: 'user',\r\n            content: message.content\r\n        };\r\n\r\n        setMessages(prev => [...prev, userMsg]);\r\n        setInput(''); // Clear input if used via handleSubmit logic\r\n\r\n        // Create Assistant Placeholder\r\n        const assistantMsgId = uuidv4();\r\n        let assistantContent = '';\r\n\r\n        setMessages(prev => [...prev, {\r\n            id: assistantMsgId,\r\n            role: 'assistant',\r\n            content: ''\r\n        }]);\r\n\r\n        try {\r\n            abortControllerRef.current = new AbortController();\r\n\r\n            const res = await fetch('/api/chat', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify({\r\n                    messages: [...messages, userMsg],\r\n                    sessionId,\r\n                    images: options?.body?.images,\r\n                    imageUrls: options?.body?.imageUrls  // Public URLs for modification mode\r\n                }),\r\n                signal: abortControllerRef.current.signal\r\n            });\r\n\r\n            if (!res.ok) {\r\n                const errText = await res.text();\r\n                throw new Error(`API Error: ${res.status} ${errText}`);\r\n            }\r\n\r\n            if (!res.body) throw new Error('No response body');\r\n\r\n            const reader = res.body.getReader();\r\n            const decoder = new TextDecoder();\r\n            let buffer = '';\r\n            let assistantContent = '';\r\n            let assistantTools: ToolInvocation[] = [];\r\n\r\n            while (true) {\r\n                const { done, value } = await reader.read();\r\n                if (done) break;\r\n\r\n                const chunk = decoder.decode(value, { stream: true });\r\n                buffer += chunk;\r\n                const lines = buffer.split('\\n');\r\n                buffer = lines.pop() || ''; // Keep partial line\r\n\r\n                for (const line of lines) {\r\n                    if (!line.trim()) continue;\r\n\r\n                    // Parse Vercel Data Stream Protocol manually\r\n                    // Format: 0:\"text_content\"\r\n                    const colonIndex = line.indexOf(':');\r\n                    if (colonIndex === -1) continue;\r\n\r\n                    const code = line.substring(0, colonIndex);\r\n                    const rest = line.substring(colonIndex + 1);\r\n\r\n                    try {\r\n                        const parsed = JSON.parse(rest);\r\n                        if (code === '0') {\r\n                            // Text chunk\r\n                            assistantContent += parsed;\r\n                            setMessages(prev => prev.map(m =>\r\n                                m.id === assistantMsgId ? { ...m, content: assistantContent, toolInvocations: assistantTools } : m\r\n                            ));\r\n                        } else if (code === '3') {\r\n                            // Error chunk\r\n                            if (parsed.error) throw new Error(parsed.error);\r\n                        } else if (code === '9') {\r\n                            // Tool Call chunk\r\n                            const toolCall = {\r\n                                toolCallId: parsed.toolCallId,\r\n                                toolName: parsed.toolName,\r\n                                args: parsed.args,\r\n                                state: 'call' as const\r\n                            };\r\n                            assistantTools.push(toolCall);\r\n                            setMessages(prev => prev.map(m =>\r\n                                m.id === assistantMsgId ? { ...m, content: assistantContent, toolInvocations: [...assistantTools] } : m\r\n                            ));\r\n                        } else if (code === 'a') {\r\n                            // Tool Result chunk\r\n                            const toolIndex = assistantTools.findIndex(t => t.toolCallId === parsed.toolCallId);\r\n                            if (toolIndex !== -1) {\r\n                                assistantTools[toolIndex] = {\r\n                                    ...assistantTools[toolIndex],\r\n                                    state: 'result',\r\n                                    result: parsed.result\r\n                                };\r\n                                setMessages(prev => prev.map(m =>\r\n                                    m.id === assistantMsgId ? { ...m, content: assistantContent, toolInvocations: [...assistantTools] } : m\r\n                                ));\r\n                            }\r\n                        }\r\n                    } catch (e) {\r\n                        // Ignore parsing errors for individual lines\r\n                    }\r\n                }\r\n            }\r\n\r\n        } catch (err: any) {\r\n            if (err.name !== 'AbortError') {\r\n                console.error(\"Chat Stream Error:\", err);\r\n                setError(err);\r\n                // Optional: Remove the failed assistant message or show error state\r\n            }\r\n        } finally {\r\n            setIsLoading(false);\r\n            abortControllerRef.current = null;\r\n        }\r\n\r\n    }, [messages, sessionId]);\r\n\r\n    const handleSubmit = useCallback(async (e?: any, options?: any) => {\r\n        if (e) e.preventDefault();\r\n        if (!input.trim()) return;\r\n\r\n        await append({ role: 'user', content: input }, options);\r\n    }, [input, append]);\r\n\r\n    return {\r\n        messages,\r\n        input,\r\n        handleInputChange,\r\n        handleSubmit,\r\n        setInput,\r\n        append,\r\n        setMessages,\r\n        isLoading,\r\n        error\r\n    };\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;;AAkBO,SAAS,QAAQ,SAAiB,EAAE,kBAAyB,EAAE;;IAClE,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAY;IACpD,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAC;IACnC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAC3C,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAoB;IACtD,MAAM,qBAAqB,IAAA,uKAAM,EAAyB;IAE1D,0BAA0B;IAC1B,IAAA,0KAAS;6BAAC;YACN,IAAI,CAAC,aAAa,gBAAgB,MAAM,GAAG,GAAG;YAE9C,MAAM;kDAAe;oBACjB,IAAI;wBACA,MAAM,MAAM,MAAM,MAAM,CAAC,4BAA4B,EAAE,WAAW;wBAClE,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM;wBAE7B,MAAM,OAAO,MAAM,IAAI,IAAI;wBAC3B,IAAI,KAAK,QAAQ,IAAI,MAAM,OAAO,CAAC,KAAK,QAAQ,GAAG;4BAC/C,YAAY,KAAK,QAAQ;wBAC7B;oBACJ,EAAE,OAAO,KAAK;wBACV,QAAQ,KAAK,CAAC,qCAAqC;oBACvD;gBACJ;;YAEA;QACJ;4BAAG;QAAC;QAAW,gBAAgB,MAAM;KAAC;IAEtC,MAAM,oBAAoB,CAAC;QACvB,SAAS,EAAE,MAAM,CAAC,KAAK;IAC3B;IAEA,MAAM,SAAS,IAAA,4KAAW;uCAAC,OACvB,SACA;YAEA,aAAa;YACb,SAAS;YAET,+CAA+C;YAC/C,MAAM,YAAY,IAAA,8LAAM;YACxB,MAAM,UAAmB;gBACrB,IAAI;gBACJ,MAAM;gBACN,SAAS,QAAQ,OAAO;YAC5B;YAEA;+CAAY,CAAA,OAAQ;2BAAI;wBAAM;qBAAQ;;YACtC,SAAS,KAAK,6CAA6C;YAE3D,+BAA+B;YAC/B,MAAM,iBAAiB,IAAA,8LAAM;YAC7B,IAAI,mBAAmB;YAEvB;+CAAY,CAAA,OAAQ;2BAAI;wBAAM;4BAC1B,IAAI;4BACJ,MAAM;4BACN,SAAS;wBACb;qBAAE;;YAEF,IAAI;gBACA,mBAAmB,OAAO,GAAG,IAAI;gBAEjC,MAAM,MAAM,MAAM,MAAM,aAAa;oBACjC,QAAQ;oBACR,SAAS;wBACL,gBAAgB;oBACpB;oBACA,MAAM,KAAK,SAAS,CAAC;wBACjB,UAAU;+BAAI;4BAAU;yBAAQ;wBAChC;wBACA,QAAQ,SAAS,MAAM;wBACvB,WAAW,SAAS,MAAM,UAAW,oCAAoC;oBAC7E;oBACA,QAAQ,mBAAmB,OAAO,CAAC,MAAM;gBAC7C;gBAEA,IAAI,CAAC,IAAI,EAAE,EAAE;oBACT,MAAM,UAAU,MAAM,IAAI,IAAI;oBAC9B,MAAM,IAAI,MAAM,CAAC,WAAW,EAAE,IAAI,MAAM,CAAC,CAAC,EAAE,SAAS;gBACzD;gBAEA,IAAI,CAAC,IAAI,IAAI,EAAE,MAAM,IAAI,MAAM;gBAE/B,MAAM,SAAS,IAAI,IAAI,CAAC,SAAS;gBACjC,MAAM,UAAU,IAAI;gBACpB,IAAI,SAAS;gBACb,IAAI,mBAAmB;gBACvB,IAAI,iBAAmC,EAAE;gBAEzC,MAAO,KAAM;oBACT,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,OAAO,IAAI;oBACzC,IAAI,MAAM;oBAEV,MAAM,QAAQ,QAAQ,MAAM,CAAC,OAAO;wBAAE,QAAQ;oBAAK;oBACnD,UAAU;oBACV,MAAM,QAAQ,OAAO,KAAK,CAAC;oBAC3B,SAAS,MAAM,GAAG,MAAM,IAAI,oBAAoB;oBAEhD,KAAK,MAAM,QAAQ,MAAO;wBACtB,IAAI,CAAC,KAAK,IAAI,IAAI;wBAElB,6CAA6C;wBAC7C,2BAA2B;wBAC3B,MAAM,aAAa,KAAK,OAAO,CAAC;wBAChC,IAAI,eAAe,CAAC,GAAG;wBAEvB,MAAM,OAAO,KAAK,SAAS,CAAC,GAAG;wBAC/B,MAAM,OAAO,KAAK,SAAS,CAAC,aAAa;wBAEzC,IAAI;4BACA,MAAM,SAAS,KAAK,KAAK,CAAC;4BAC1B,IAAI,SAAS,KAAK;gCACd,aAAa;gCACb,oBAAoB;gCACpB;mEAAY,CAAA,OAAQ,KAAK,GAAG;2EAAC,CAAA,IACzB,EAAE,EAAE,KAAK,iBAAiB;oDAAE,GAAG,CAAC;oDAAE,SAAS;oDAAkB,iBAAiB;gDAAe,IAAI;;;4BAEzG,OAAO,IAAI,SAAS,KAAK;gCACrB,cAAc;gCACd,IAAI,OAAO,KAAK,EAAE,MAAM,IAAI,MAAM,OAAO,KAAK;4BAClD,OAAO,IAAI,SAAS,KAAK;gCACrB,kBAAkB;gCAClB,MAAM,WAAW;oCACb,YAAY,OAAO,UAAU;oCAC7B,UAAU,OAAO,QAAQ;oCACzB,MAAM,OAAO,IAAI;oCACjB,OAAO;gCACX;gCACA,eAAe,IAAI,CAAC;gCACpB;mEAAY,CAAA,OAAQ,KAAK,GAAG;2EAAC,CAAA,IACzB,EAAE,EAAE,KAAK,iBAAiB;oDAAE,GAAG,CAAC;oDAAE,SAAS;oDAAkB,iBAAiB;2DAAI;qDAAe;gDAAC,IAAI;;;4BAE9G,OAAO,IAAI,SAAS,KAAK;gCACrB,oBAAoB;gCACpB,MAAM,YAAY,eAAe,SAAS;6EAAC,CAAA,IAAK,EAAE,UAAU,KAAK,OAAO,UAAU;;gCAClF,IAAI,cAAc,CAAC,GAAG;oCAClB,cAAc,CAAC,UAAU,GAAG;wCACxB,GAAG,cAAc,CAAC,UAAU;wCAC5B,OAAO;wCACP,QAAQ,OAAO,MAAM;oCACzB;oCACA;uEAAY,CAAA,OAAQ,KAAK,GAAG;+EAAC,CAAA,IACzB,EAAE,EAAE,KAAK,iBAAiB;wDAAE,GAAG,CAAC;wDAAE,SAAS;wDAAkB,iBAAiB;+DAAI;yDAAe;oDAAC,IAAI;;;gCAE9G;4BACJ;wBACJ,EAAE,OAAO,GAAG;wBACR,6CAA6C;wBACjD;oBACJ;gBACJ;YAEJ,EAAE,OAAO,KAAU;gBACf,IAAI,IAAI,IAAI,KAAK,cAAc;oBAC3B,QAAQ,KAAK,CAAC,sBAAsB;oBACpC,SAAS;gBACT,oEAAoE;gBACxE;YACJ,SAAU;gBACN,aAAa;gBACb,mBAAmB,OAAO,GAAG;YACjC;QAEJ;sCAAG;QAAC;QAAU;KAAU;IAExB,MAAM,eAAe,IAAA,4KAAW;6CAAC,OAAO,GAAS;YAC7C,IAAI,GAAG,EAAE,cAAc;YACvB,IAAI,CAAC,MAAM,IAAI,IAAI;YAEnB,MAAM,OAAO;gBAAE,MAAM;gBAAQ,SAAS;YAAM,GAAG;QACnD;4CAAG;QAAC;QAAO;KAAO;IAElB,OAAO;QACH;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;IACJ;AACJ;GAxLgB"}},
    {"offset": {"line": 2759, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User01/.gemini/antigravity/scratch/renovation-next/web_client/hooks/useImageUpload.ts"],"sourcesContent":["import { useState } from 'react';\r\n\r\n/**\r\n * Custom hook for image upload, compression, and preview management\r\n * \r\n * ENHANCED: Now uploads images to Firebase Storage immediately to get public URLs\r\n * This enables image-to-image modification mode with persistent URLs\r\n */\r\n\r\ninterface ImageData {\r\n    preview: string;  // base64 for local preview\r\n    publicUrl: string; // Firebase Storage URL for AI (modification mode)\r\n}\r\n\r\nexport function useImageUpload(sessionId?: string) {\r\n    // Store both preview (base64) and public URL\r\n    const [selectedImages, setSelectedImages] = useState<string[]>([]); // base64 for backward compatibility\r\n    const [imageUrls, setImageUrls] = useState<string[]>([]); // Public URLs for modification mode\r\n    const [isUploading, setIsUploading] = useState(false);\r\n    const [uploadStatus, setUploadStatus] = useState<string>('');\r\n\r\n    // Image Compression with Automatic Aggressive Mode for Large Files\r\n    const compressImageForGemini = async (file: File, targetMaxSize?: number): Promise<Blob> => {\r\n        const maxSizeMB = targetMaxSize || 10; // 10MB default\r\n        const maxSizeBytes = maxSizeMB * 1024 * 1024;\r\n\r\n        // Initial settings for normal compression\r\n        let maxWidth = 2048;\r\n        let quality = 0.8;\r\n        const mimeType = 'image/jpeg';\r\n\r\n        // 🔥 AGGRESSIVE MODE: If file is > maxSize, use more aggressive settings\r\n        if (file.size > maxSizeBytes) {\r\n            console.log(`[Aggressive Compression] File is ${(file.size / 1024 / 1024).toFixed(2)}MB, targeting ${maxSizeMB}MB`);\r\n\r\n            // Calculate a rough ratio to determine how aggressive we need to be\r\n            const ratio = file.size / maxSizeBytes;\r\n\r\n            if (ratio > 8) { // > 80MB\r\n                maxWidth = 1024;\r\n                quality = 0.5;\r\n            } else if (ratio > 4) { // > 40MB\r\n                maxWidth = 1280;\r\n                quality = 0.6;\r\n            } else if (ratio > 2) { // > 20MB\r\n                maxWidth = 1536;\r\n                quality = 0.7;\r\n            } else { // 10-20MB\r\n                maxWidth = 1800;\r\n                quality = 0.75;\r\n            }\r\n\r\n            console.log(`[Aggressive Compression] Using: maxWidth=${maxWidth}px, quality=${quality}`);\r\n        }\r\n\r\n        return new Promise((resolve, reject) => {\r\n            const img = new Image();\r\n            const url = URL.createObjectURL(file);\r\n\r\n            img.onload = () => {\r\n                URL.revokeObjectURL(url);\r\n                const canvas = document.createElement('canvas');\r\n\r\n                // Calculate new dimensions maintaining aspect ratio\r\n                let width = img.width;\r\n                let height = img.height;\r\n\r\n                if (width > maxWidth) {\r\n                    height = (height * maxWidth) / width;\r\n                    width = maxWidth;\r\n                }\r\n\r\n                canvas.width = width;\r\n                canvas.height = height;\r\n\r\n                const ctx = canvas.getContext('2d');\r\n                if (!ctx) {\r\n                    reject(new Error('Canvas context not available'));\r\n                    return;\r\n                }\r\n\r\n                ctx.drawImage(img, 0, 0, width, height);\r\n\r\n                canvas.toBlob(\r\n                    (blob) => {\r\n                        if (blob) {\r\n                            // Verify final size\r\n                            if (blob.size > maxSizeBytes && quality > 0.5) {\r\n                                console.warn('Still too large, retrying with quality 0.5...');\r\n                                // Retry with lower quality if still too big\r\n                                canvas.toBlob((retryBlob) => {\r\n                                    if (retryBlob) resolve(retryBlob);\r\n                                    else reject(new Error('Compression failed'));\r\n                                }, mimeType, 0.5);\r\n                            } else {\r\n                                resolve(blob);\r\n                            }\r\n                        } else {\r\n                            reject(new Error('Compression failed'));\r\n                        }\r\n                    },\r\n                    mimeType,\r\n                    quality\r\n                );\r\n            };\r\n\r\n            img.onerror = (error) => reject(error);\r\n            img.src = url;\r\n        });\r\n    };\r\n\r\n    // Handle File Selection with Immediate Upload to Storage\r\n    const handleFileSelect = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        if (e.target.files && e.target.files[0]) {\r\n            const file = e.target.files[0];\r\n\r\n            setIsUploading(true);\r\n            setUploadStatus('Preparazione...');\r\n\r\n            // ℹ️ INFO: Inform user if file is large (will be compressed automatically)\r\n            const maxFileSize = 10 * 1024 * 1024; // 10MB\r\n            if (file.size > maxFileSize) {\r\n                const sizeMB = (file.size / 1024 / 1024).toFixed(2);\r\n                console.log(`[Image Upload] Large file detected: ${sizeMB}MB - Will compress automatically`);\r\n                setUploadStatus(`Compressione (${sizeMB}MB)...`);\r\n            }\r\n\r\n            try {\r\n                // Step 1: Compress image (automatically handles large files)\r\n                const compressed = await compressImageForGemini(file);\r\n                const originalKB = (file.size / 1024).toFixed(0);\r\n                const compressedKB = (compressed.size / 1024).toFixed(0);\r\n                console.log(`[Image Upload] Compressed: ${originalKB}KB → ${compressedKB}KB`);\r\n\r\n                // Step 2: Convert to base64\r\n                const base64 = await new Promise<string>((resolve, reject) => {\r\n                    const reader = new FileReader();\r\n                    reader.onloadend = () => resolve(reader.result as string);\r\n                    reader.onerror = reject;\r\n                    reader.readAsDataURL(compressed);\r\n                });\r\n\r\n                // Step 3: Upload to Firebase Storage (if sessionId available)\r\n                let publicUrl = '';\r\n\r\n                if (sessionId) {\r\n                    setUploadStatus('Caricamento...');\r\n                    console.log('[Image Upload] Uploading to Storage for persistent URL...');\r\n\r\n                    try {\r\n                        const uploadResponse = await fetch('/api/upload-image', {\r\n                            method: 'POST',\r\n                            headers: { 'Content-Type': 'application/json' },\r\n                            body: JSON.stringify({\r\n                                image: base64,\r\n                                sessionId: sessionId,\r\n                            }),\r\n                        });\r\n\r\n                        if (!uploadResponse.ok) {\r\n                            throw new Error(`Upload failed: ${uploadResponse.status}`);\r\n                        }\r\n\r\n                        const uploadResult = await uploadResponse.json();\r\n\r\n                        if (uploadResult.success && uploadResult.url) {\r\n                            publicUrl = uploadResult.url;\r\n                            console.log('[Image Upload] ✅ Public URL:', publicUrl);\r\n                        } else {\r\n                            console.error('[Image Upload] Upload failed:', uploadResult.error);\r\n                        }\r\n                    } catch (uploadErr) {\r\n                        console.error('[Image Upload] Storage upload error:', uploadErr);\r\n                        console.warn('[Image Upload] Continuing without public URL (modification mode will not work)');\r\n                    }\r\n                } else {\r\n                    console.warn('[Image Upload] No sessionId provided - skipping Storage upload');\r\n                }\r\n\r\n                // Step 4: Save to state\r\n                setSelectedImages(prev => [...prev, base64]); // For preview\r\n                if (publicUrl) {\r\n                    setImageUrls(prev => [...prev, publicUrl]); // For AI modification mode\r\n                }\r\n\r\n                setUploadStatus('Pronto!');\r\n                // Clear status after delay\r\n                setTimeout(() => setUploadStatus(''), 2000);\r\n\r\n            } catch (err) {\r\n                console.error('[Image Upload] Error:', err);\r\n                alert('⚠️ Errore durante il caricamento dell\\'immagine. Prova con un file più piccolo.');\r\n                setUploadStatus('Errore');\r\n                // Reset input\r\n                e.target.value = '';\r\n            } finally {\r\n                setIsUploading(false);\r\n            }\r\n        }\r\n    };\r\n\r\n    // Remove selected image (both preview and URL)\r\n    const removeImage = (index: number) => {\r\n        setSelectedImages((prev) => prev.filter((_, i) => i !== index));\r\n        setImageUrls((prev) => prev.filter((_, i) => i !== index));\r\n    };\r\n\r\n    // Clear all images (both previews and URLs)\r\n    const clearImages = () => {\r\n        setSelectedImages([]);\r\n        setImageUrls([]);\r\n    };\r\n\r\n    return {\r\n        selectedImages,    // base64 for preview (backward compatible)\r\n        imageUrls,         // Public Storage URLs for modification mode\r\n        isUploading,\r\n        uploadStatus,\r\n        handleFileSelect,\r\n        removeImage,\r\n        clearImages\r\n    };\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2956, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User01/.gemini/antigravity/scratch/renovation-next/web_client/hooks/useChatScroll.ts"],"sourcesContent":["import { useRef, useEffect } from 'react';\r\n\r\n/**\r\n * Custom hook for managing auto-scroll behavior in chat messages\r\n * Extracted from ChatWidget.tsx (lines 232-280)\r\n */\r\nexport function useChatScroll(messagesLength: number, isOpen: boolean) {\r\n    const messagesContainerRef = useRef<HTMLDivElement | null>(null);\r\n    const messagesEndRef = useRef<HTMLDivElement | null>(null);\r\n    const prevMessagesLengthRef = useRef(messagesLength);\r\n\r\n    // Auto-scroll logic\r\n    const scrollToBottom = (behavior: ScrollBehavior = 'smooth') => {\r\n        if (messagesContainerRef.current) {\r\n            messagesContainerRef.current.scrollTop = messagesContainerRef.current.scrollHeight;\r\n        }\r\n        if (messagesEndRef.current) {\r\n            messagesEndRef.current.scrollIntoView({ behavior, block: 'end' });\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        // Scroll when messages change or chat opens\r\n        if (messagesLength !== prevMessagesLengthRef.current || isOpen) {\r\n            scrollToBottom(isOpen && prevMessagesLengthRef.current === messagesLength ? 'instant' : 'smooth');\r\n            prevMessagesLengthRef.current = messagesLength;\r\n        }\r\n    }, [messagesLength, isOpen]);\r\n\r\n    return {\r\n        messagesContainerRef,\r\n        messagesEndRef,\r\n        scrollToBottom\r\n    };\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;;AAMO,SAAS,cAAc,cAAsB,EAAE,MAAe;;IACjE,MAAM,uBAAuB,IAAA,uKAAM,EAAwB;IAC3D,MAAM,iBAAiB,IAAA,uKAAM,EAAwB;IACrD,MAAM,wBAAwB,IAAA,uKAAM,EAAC;IAErC,oBAAoB;IACpB,MAAM,iBAAiB,CAAC,WAA2B,QAAQ;QACvD,IAAI,qBAAqB,OAAO,EAAE;YAC9B,qBAAqB,OAAO,CAAC,SAAS,GAAG,qBAAqB,OAAO,CAAC,YAAY;QACtF;QACA,IAAI,eAAe,OAAO,EAAE;YACxB,eAAe,OAAO,CAAC,cAAc,CAAC;gBAAE;gBAAU,OAAO;YAAM;QACnE;IACJ;IAEA,IAAA,0KAAS;mCAAC;YACN,4CAA4C;YAC5C,IAAI,mBAAmB,sBAAsB,OAAO,IAAI,QAAQ;gBAC5D,eAAe,UAAU,sBAAsB,OAAO,KAAK,iBAAiB,YAAY;gBACxF,sBAAsB,OAAO,GAAG;YACpC;QACJ;kCAAG;QAAC;QAAgB;KAAO;IAE3B,OAAO;QACH;QACA;QACA;IACJ;AACJ;GA5BgB"}},
    {"offset": {"line": 3006, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User01/.gemini/antigravity/scratch/renovation-next/web_client/hooks/useMobileViewport.ts"],"sourcesContent":["import { useState, useEffect, RefObject } from 'react';\r\n\r\n/**\r\n * Custom hook for mobile viewport handling and body scroll locking\r\n * Extracted from ChatWidget.tsx (lines 222-230, 419-458)\r\n * Handles iOS keyboard resize and prevents background scroll\r\n */\r\nexport function useMobileViewport(isOpen: boolean, chatContainerRef: RefObject<HTMLDivElement | null>) {\r\n    const [isMobile, setIsMobile] = useState(false);\r\n\r\n    // Detect mobile\r\n    useEffect(() => {\r\n        setIsMobile(window.innerWidth < 768);\r\n        const handleResize = () => setIsMobile(window.innerWidth < 768);\r\n        window.addEventListener('resize', handleResize);\r\n        return () => window.removeEventListener('resize', handleResize);\r\n    }, []);\r\n\r\n    // Viewport Logic (Mobile/iOS Fix)\r\n    useEffect(() => {\r\n        if (!isOpen) return;\r\n\r\n        const handleResize = () => {\r\n            if (window.visualViewport && window.innerWidth < 768) {\r\n                const h = window.visualViewport.height;\r\n                if (chatContainerRef.current) chatContainerRef.current.style.height = `${h}px`;\r\n                window.scrollTo(0, 0); // iOS Fix\r\n            } else {\r\n                if (chatContainerRef.current) chatContainerRef.current.style.height = '';\r\n            }\r\n        };\r\n\r\n        if (window.visualViewport) {\r\n            window.visualViewport.addEventListener('resize', handleResize);\r\n            window.visualViewport.addEventListener('scroll', handleResize);\r\n            handleResize();\r\n        }\r\n        window.addEventListener('resize', handleResize);\r\n\r\n        return () => {\r\n            if (window.visualViewport) {\r\n                window.visualViewport.removeEventListener('resize', handleResize);\r\n                window.visualViewport.removeEventListener('scroll', handleResize);\r\n            }\r\n            window.removeEventListener('resize', handleResize);\r\n        };\r\n    }, [isOpen, chatContainerRef]);\r\n\r\n    // Body Lock\r\n    useEffect(() => {\r\n        const html = document.documentElement;\r\n        const body = document.body;\r\n\r\n        if (isOpen) {\r\n            html.style.overflow = 'hidden';\r\n            html.style.height = '100%';\r\n            html.style.position = 'fixed';\r\n            html.style.overscrollBehavior = 'none';\r\n            body.style.overflow = 'hidden';\r\n            body.style.height = '100%';\r\n            body.style.position = 'fixed';\r\n            body.style.overscrollBehavior = 'none';\r\n        } else {\r\n            html.style.overflow = '';\r\n            html.style.height = '';\r\n            html.style.position = '';\r\n            html.style.overscrollBehavior = '';\r\n            body.style.overflow = '';\r\n            body.style.height = '';\r\n            body.style.position = '';\r\n            body.style.overscrollBehavior = '';\r\n        }\r\n    }, [isOpen]);\r\n\r\n    return { isMobile };\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;;AAOO,SAAS,kBAAkB,MAAe,EAAE,gBAAkD;;IACjG,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAC;IAEzC,gBAAgB;IAChB,IAAA,0KAAS;uCAAC;YACN,YAAY,OAAO,UAAU,GAAG;YAChC,MAAM;4DAAe,IAAM,YAAY,OAAO,UAAU,GAAG;;YAC3D,OAAO,gBAAgB,CAAC,UAAU;YAClC;+CAAO,IAAM,OAAO,mBAAmB,CAAC,UAAU;;QACtD;sCAAG,EAAE;IAEL,kCAAkC;IAClC,IAAA,0KAAS;uCAAC;YACN,IAAI,CAAC,QAAQ;YAEb,MAAM;4DAAe;oBACjB,IAAI,OAAO,cAAc,IAAI,OAAO,UAAU,GAAG,KAAK;wBAClD,MAAM,IAAI,OAAO,cAAc,CAAC,MAAM;wBACtC,IAAI,iBAAiB,OAAO,EAAE,iBAAiB,OAAO,CAAC,KAAK,CAAC,MAAM,GAAG,GAAG,EAAE,EAAE,CAAC;wBAC9E,OAAO,QAAQ,CAAC,GAAG,IAAI,UAAU;oBACrC,OAAO;wBACH,IAAI,iBAAiB,OAAO,EAAE,iBAAiB,OAAO,CAAC,KAAK,CAAC,MAAM,GAAG;oBAC1E;gBACJ;;YAEA,IAAI,OAAO,cAAc,EAAE;gBACvB,OAAO,cAAc,CAAC,gBAAgB,CAAC,UAAU;gBACjD,OAAO,cAAc,CAAC,gBAAgB,CAAC,UAAU;gBACjD;YACJ;YACA,OAAO,gBAAgB,CAAC,UAAU;YAElC;+CAAO;oBACH,IAAI,OAAO,cAAc,EAAE;wBACvB,OAAO,cAAc,CAAC,mBAAmB,CAAC,UAAU;wBACpD,OAAO,cAAc,CAAC,mBAAmB,CAAC,UAAU;oBACxD;oBACA,OAAO,mBAAmB,CAAC,UAAU;gBACzC;;QACJ;sCAAG;QAAC;QAAQ;KAAiB;IAE7B,YAAY;IACZ,IAAA,0KAAS;uCAAC;YACN,MAAM,OAAO,SAAS,eAAe;YACrC,MAAM,OAAO,SAAS,IAAI;YAE1B,IAAI,QAAQ;gBACR,KAAK,KAAK,CAAC,QAAQ,GAAG;gBACtB,KAAK,KAAK,CAAC,MAAM,GAAG;gBACpB,KAAK,KAAK,CAAC,QAAQ,GAAG;gBACtB,KAAK,KAAK,CAAC,kBAAkB,GAAG;gBAChC,KAAK,KAAK,CAAC,QAAQ,GAAG;gBACtB,KAAK,KAAK,CAAC,MAAM,GAAG;gBACpB,KAAK,KAAK,CAAC,QAAQ,GAAG;gBACtB,KAAK,KAAK,CAAC,kBAAkB,GAAG;YACpC,OAAO;gBACH,KAAK,KAAK,CAAC,QAAQ,GAAG;gBACtB,KAAK,KAAK,CAAC,MAAM,GAAG;gBACpB,KAAK,KAAK,CAAC,QAAQ,GAAG;gBACtB,KAAK,KAAK,CAAC,kBAAkB,GAAG;gBAChC,KAAK,KAAK,CAAC,QAAQ,GAAG;gBACtB,KAAK,KAAK,CAAC,MAAM,GAAG;gBACpB,KAAK,KAAK,CAAC,QAAQ,GAAG;gBACtB,KAAK,KAAK,CAAC,kBAAkB,GAAG;YACpC;QACJ;sCAAG;QAAC;KAAO;IAEX,OAAO;QAAE;IAAS;AACtB;GApEgB"}},
    {"offset": {"line": 3104, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User01/.gemini/antigravity/scratch/renovation-next/web_client/hooks/useTypingIndicator.ts"],"sourcesContent":["import { useState, useEffect } from 'react';\r\n\r\n/**\r\n * Custom hook for managing contextual typing indicator messages\r\n * Extracted from ChatWidget.tsx (lines 220, 238-261)\r\n */\r\nexport function useTypingIndicator(isLoading: boolean) {\r\n    const [typingMessage, setTypingMessage] = useState('SYD sta pensando...');\r\n\r\n    useEffect(() => {\r\n        if (!isLoading) {\r\n            setTypingMessage('Sto pensando...');\r\n            return;\r\n        }\r\n\r\n        const typingMessages = [\r\n            'Sto analizzando...',\r\n            'Sto elaborando la risposta...',\r\n            'Sto disegnando...',\r\n            'Quasi pronto...'\r\n        ];\r\n\r\n        let index = 0;\r\n        setTypingMessage(typingMessages[0]);\r\n\r\n        const interval = setInterval(() => {\r\n            index = (index + 1) % typingMessages.length;\r\n            setTypingMessage(typingMessages[index]);\r\n        }, 2000);\r\n\r\n        return () => clearInterval(interval);\r\n    }, [isLoading]);\r\n\r\n    return typingMessage;\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;;AAMO,SAAS,mBAAmB,SAAkB;;IACjD,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,yKAAQ,EAAC;IAEnD,IAAA,0KAAS;wCAAC;YACN,IAAI,CAAC,WAAW;gBACZ,iBAAiB;gBACjB;YACJ;YAEA,MAAM,iBAAiB;gBACnB;gBACA;gBACA;gBACA;aACH;YAED,IAAI,QAAQ;YACZ,iBAAiB,cAAc,CAAC,EAAE;YAElC,MAAM,WAAW;yDAAY;oBACzB,QAAQ,CAAC,QAAQ,CAAC,IAAI,eAAe,MAAM;oBAC3C,iBAAiB,cAAc,CAAC,MAAM;gBAC1C;wDAAG;YAEH;gDAAO,IAAM,cAAc;;QAC/B;uCAAG;QAAC;KAAU;IAEd,OAAO;AACX;GA5BgB"}},
    {"offset": {"line": 3151, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User01/.gemini/antigravity/scratch/renovation-next/web_client/components/ArchitectAvatar.tsx"],"sourcesContent":["import React from 'react';\r\nimport Image from 'next/image';\r\nimport { cn } from '@/lib/utils';\r\n\r\nexport default function ArchitectAvatar({ className }: { className?: string }) {\r\n    return (\r\n        <div className={cn(\"relative w-12 h-12 shadow-sm group flex items-center justify-center bg-indigo-50 rounded-full overflow-hidden border-2 border-white/20\", className)}>\r\n            <Image\r\n                src=\"/assets/syd_avatar_final_v2.jpg\"\r\n                alt=\"SYD Avatar\"\r\n                fill\r\n                sizes=\"128px\"\r\n                className=\"object-cover scale-110 transition-transform duration-500 group-hover:scale-125\"\r\n                priority\r\n            />\r\n        </div>\r\n    );\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;AACA;AACA;;;;AAEe,SAAS,gBAAgB,EAAE,SAAS,EAA0B;IACzE,qBACI,6LAAC;QAAI,WAAW,IAAA,mIAAE,EAAC,0IAA0I;kBACzJ,cAAA,6LAAC,2IAAK;YACF,KAAI;YACJ,KAAI;YACJ,IAAI;YACJ,OAAM;YACN,WAAU;YACV,QAAQ;;;;;;;;;;;AAIxB;KAbwB"}},
    {"offset": {"line": 3192, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User01/.gemini/antigravity/scratch/renovation-next/web_client/components/chat/ChatHeader.tsx"],"sourcesContent":["import React from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Minimize2 } from 'lucide-react';\r\nimport ArchitectAvatar from '@/components/ArchitectAvatar';\r\n\r\ninterface ChatHeaderProps {\r\n    onMinimize: () => void;\r\n}\r\n\r\n/**\r\n * Chat header component with avatar, status, and minimize button\r\n * Extracted from ChatWidget.tsx (lines 516-526)\r\n */\r\nexport function ChatHeader({ onMinimize }: ChatHeaderProps) {\r\n    return (\r\n        <div\r\n            className=\"flex items-center justify-between p-4 border-b border-white/5 bg-slate-900/50 flex-shrink-0\"\r\n            style={{ paddingTop: 'max(1rem, env(safe-area-inset-top))' }}\r\n        >\r\n            <div className=\"flex items-center gap-3\">\r\n                <ArchitectAvatar />\r\n                <div>\r\n                    <h3 className=\"font-bold text-white flex items-center gap-2\">\r\n                        SYD\r\n                        <span\r\n                            className=\"text-[9px] font-medium px-2 py-0.5 rounded-md backdrop-blur-md border border-white/20 text-blue-200\"\r\n                            style={{ background: 'linear-gradient(135deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0.08) 100%)' }}\r\n                        >\r\n                            Architetto personale\r\n                        </span>\r\n                    </h3>\r\n                    <p className=\"text-xs text-slate-400 flex items-center gap-3\">\r\n                        <span className=\"flex items-center gap-1\">\r\n                            <span className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\" />\r\n                            Online\r\n                        </span>\r\n                    </p>\r\n                </div>\r\n            </div>\r\n            <Button\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                onClick={onMinimize}\r\n                className=\"text-slate-400 hover:text-white\"\r\n            >\r\n                <Minimize2 className=\"w-5 h-5\" />\r\n            </Button>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;;;;;AAUO,SAAS,WAAW,EAAE,UAAU,EAAmB;IACtD,qBACI,6LAAC;QACG,WAAU;QACV,OAAO;YAAE,YAAY;QAAsC;;0BAE3D,6LAAC;gBAAI,WAAU;;kCACX,6LAAC,0JAAe;;;;;kCAChB,6LAAC;;0CACG,6LAAC;gCAAG,WAAU;;oCAA+C;kDAEzD,6LAAC;wCACG,WAAU;wCACV,OAAO;4CAAE,YAAY;wCAAkF;kDAC1G;;;;;;;;;;;;0CAIL,6LAAC;gCAAE,WAAU;0CACT,cAAA,6LAAC;oCAAK,WAAU;;sDACZ,6LAAC;4CAAK,WAAU;;;;;;wCAAoD;;;;;;;;;;;;;;;;;;;;;;;;0BAMpF,6LAAC,sJAAM;gBACH,SAAQ;gBACR,MAAK;gBACL,SAAS;gBACT,WAAU;0BAEV,cAAA,6LAAC,gOAAS;oBAAC,WAAU;;;;;;;;;;;;;;;;;AAIrC;KApCgB"}},
    {"offset": {"line": 3312, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User01/.gemini/antigravity/scratch/renovation-next/web_client/components/chat/ImagePreview.tsx"],"sourcesContent":["import React from 'react';\r\nimport { Minimize2 } from 'lucide-react';\r\n\r\ninterface ImagePreviewProps {\r\n    src: string;\r\n    alt?: string;\r\n    onClick: (url: string) => void;\r\n    className?: string;\r\n}\r\n\r\n/**\r\n * Reusable image preview component with hover overlay\r\n * ✅ BUG FIX #14: Refactored duplicated image rendering logic\r\n */\r\nexport function ImagePreview({ src, alt = 'Generated image', onClick, className = '' }: ImagePreviewProps) {\r\n    return (\r\n        <span\r\n            className={`group relative mt-2 cursor-pointer overflow-hidden rounded-lg border border-white/10 block ${className}`}\r\n            onClick={() => onClick(src)}\r\n        >\r\n            <img\r\n                src={src}\r\n                alt={alt}\r\n                className=\"max-w-full h-auto transition-transform hover:scale-105\"\r\n            />\r\n            <span className=\"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center\">\r\n                <span className=\"text-xs text-white font-medium bg-black/60 px-3 py-1.5 rounded-full backdrop-blur-sm border border-white/20 flex items-center gap-1\">\r\n                    <Minimize2 className=\"w-3 h-3 rotate-45\" /> Espandi\r\n                </span>\r\n            </span>\r\n        </span>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AACA;;;AAaO,SAAS,aAAa,EAAE,GAAG,EAAE,MAAM,iBAAiB,EAAE,OAAO,EAAE,YAAY,EAAE,EAAqB;IACrG,qBACI,6LAAC;QACG,WAAW,CAAC,2FAA2F,EAAE,WAAW;QACpH,SAAS,IAAM,QAAQ;;0BAEvB,6LAAC;gBACG,KAAK;gBACL,KAAK;gBACL,WAAU;;;;;;0BAEd,6LAAC;gBAAK,WAAU;0BACZ,cAAA,6LAAC;oBAAK,WAAU;;sCACZ,6LAAC,gOAAS;4BAAC,WAAU;;;;;;wBAAsB;;;;;;;;;;;;;;;;;;AAK/D;KAlBgB"}},
    {"offset": {"line": 3375, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User01/.gemini/antigravity/scratch/renovation-next/web_client/components/chat/ToolStatus.tsx"],"sourcesContent":["import React from 'react';\r\nimport { ImagePreview } from '@/components/chat/ImagePreview';\r\n\r\ninterface ToolInvocation {\r\n    toolCallId: string;\r\n    toolName: string;\r\n    state: 'call' | 'result';\r\n    args?: any;\r\n    result?: any;\r\n}\r\n\r\ninterface ToolStatusProps {\r\n    tool: ToolInvocation;\r\n    onImageClick: (imageUrl: string) => void;\r\n}\r\n\r\n/**\r\n * Tool invocation status component\r\n * Displays loading states, results, and errors for AI tool calls\r\n * ✅ Memoized to prevent unnecessary re-renders\r\n */\r\nexport const ToolStatus = React.memo<ToolStatusProps>(({ tool, onImageClick }) => {\r\n    // Loading state: Tool is being called\r\n    if (tool.state === 'call') {\r\n        if (tool.toolName === 'generate_render') {\r\n            return (\r\n                <div className=\"flex items-center gap-2 text-sm text-slate-400 italic mt-2\">\r\n                    <span className=\"animate-pulse\">🎨</span>\r\n                    Generando rendering...\r\n                </div>\r\n            );\r\n        }\r\n\r\n        if (tool.toolName === 'submit_lead_data') {\r\n            return (\r\n                <div className=\"text-sm text-slate-400 italic mt-2\">\r\n                    📝 Salvando i tuoi dati...\r\n                </div>\r\n            );\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    // Completed state: Tool finished with result\r\n    if (tool.state === 'result') {\r\n        const result = tool.result || (tool as any).output;\r\n\r\n        // Success: Image generated\r\n        if (result?.imageUrl) {\r\n            return (\r\n                <div className=\"mt-3\">\r\n                    <ImagePreview\r\n                        src={result.imageUrl}\r\n                        alt={result.description || 'Rendering generato'}\r\n                        onClick={onImageClick}\r\n                        className=\"w-full\"\r\n                    />\r\n                </div>\r\n            );\r\n        }\r\n\r\n        // Error: Tool failed\r\n        if (result?.error || result?.status === 'error') {\r\n            return (\r\n                <div className=\"mt-3 p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm\">\r\n                    <p className=\"font-medium\">Errore generazione immagine:</p>\r\n                    <p>{result?.error || 'Si è verificato un errore sconosciuto.'}</p>\r\n                </div>\r\n            );\r\n        }\r\n    }\r\n\r\n    return null;\r\n});\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;AAoBO,MAAM,2BAAa,wKAAK,CAAC,IAAI,MAAkB,CAAC,EAAE,IAAI,EAAE,YAAY,EAAE;IACzE,sCAAsC;IACtC,IAAI,KAAK,KAAK,KAAK,QAAQ;QACvB,IAAI,KAAK,QAAQ,KAAK,mBAAmB;YACrC,qBACI,6LAAC;gBAAI,WAAU;;kCACX,6LAAC;wBAAK,WAAU;kCAAgB;;;;;;oBAAS;;;;;;;QAIrD;QAEA,IAAI,KAAK,QAAQ,KAAK,oBAAoB;YACtC,qBACI,6LAAC;gBAAI,WAAU;0BAAqC;;;;;;QAI5D;QAEA,OAAO;IACX;IAEA,6CAA6C;IAC7C,IAAI,KAAK,KAAK,KAAK,UAAU;QACzB,MAAM,SAAS,KAAK,MAAM,IAAI,AAAC,KAAa,MAAM;QAElD,2BAA2B;QAC3B,IAAI,QAAQ,UAAU;YAClB,qBACI,6LAAC;gBAAI,WAAU;0BACX,cAAA,6LAAC,oKAAY;oBACT,KAAK,OAAO,QAAQ;oBACpB,KAAK,OAAO,WAAW,IAAI;oBAC3B,SAAS;oBACT,WAAU;;;;;;;;;;;QAI1B;QAEA,qBAAqB;QACrB,IAAI,QAAQ,SAAS,QAAQ,WAAW,SAAS;YAC7C,qBACI,6LAAC;gBAAI,WAAU;;kCACX,6LAAC;wBAAE,WAAU;kCAAc;;;;;;kCAC3B,6LAAC;kCAAG,QAAQ,SAAS;;;;;;;;;;;;QAGjC;IACJ;IAEA,OAAO;AACX"}},
    {"offset": {"line": 3484, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User01/.gemini/antigravity/scratch/renovation-next/web_client/components/chat/MessageItem.tsx"],"sourcesContent":["import React, { useMemo } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { User } from 'lucide-react';\r\nimport ReactMarkdown from 'react-markdown';\r\nimport ArchitectAvatar from '@/components/ArchitectAvatar';\r\nimport { ImagePreview } from '@/components/chat/ImagePreview';\r\nimport { ToolStatus } from '@/components/chat/ToolStatus';\r\nimport { cn } from '@/lib/utils';\r\n\r\ninterface Message {\r\n    id: string;\r\n    role: string;\r\n    content: string;\r\n    toolInvocations?: Array<{\r\n        toolCallId: string;\r\n        toolName: string;\r\n        state: 'call' | 'result';\r\n        args?: any;\r\n        result?: any;\r\n    }>;\r\n    attachments?: {\r\n        images?: string[];\r\n    };\r\n}\r\n\r\ninterface MessageItemProps {\r\n    message: Message;\r\n    index: number;\r\n    onImageClick: (imageUrl: string) => void;\r\n}\r\n\r\n/**\r\n * Single message item component\r\n * Handles rendering of one chat message with its avatar, content, and attachments\r\n * ✅ Memoized to prevent unnecessary re-renders\r\n */\r\nexport const MessageItem = React.memo<MessageItemProps>(({ message, index, onImageClick }) => {\r\n    // Helper: Extract text from both old (content) and new (parts[]) formats\r\n    const getMessageText = (msg: any): string => {\r\n        if (msg.parts && Array.isArray(msg.parts)) {\r\n            return msg.parts\r\n                .filter((part: any) => part.type === 'text')\r\n                .map((part: any) => part.text)\r\n                .join('');\r\n        }\r\n        return msg.content || '';\r\n    };\r\n\r\n    const text = getMessageText(message);\r\n    const hasTools = message.toolInvocations?.length ?? 0 > 0;\r\n\r\n    // ✅ Memoize ReactMarkdown components to prevent re-creation on every render\r\n    const markdownComponents = useMemo(() => ({\r\n        img: ({ node, ...props }: any) => props.src ? (\r\n            <ImagePreview\r\n                src={String(props.src)}\r\n                alt={String(props.alt || 'Generated image')}\r\n                onClick={onImageClick}\r\n            />\r\n        ) : null\r\n    }), [onImageClick]);\r\n\r\n    // Hide empty assistant placeholders\r\n    if (message.role === 'assistant' && !text && !hasTools) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <motion.div\r\n            key={message.id || index}\r\n            initial={{ opacity: 0, y: 10 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            className={cn(\r\n                \"flex gap-3 max-w-[90%]\",\r\n                message.role === 'user' ? \"ml-auto flex-row-reverse\" : \"\"\r\n            )}\r\n        >\r\n            {/* Avatar */}\r\n            {message.role === 'user' ? (\r\n                <div className=\"w-8 h-8 rounded-full flex items-center justify-center shrink-0 border mt-1 bg-blue-600 border-blue-500 text-white\">\r\n                    <User className=\"w-4 h-4\" />\r\n                </div>\r\n            ) : (\r\n                <ArchitectAvatar className=\"w-8 h-8 mt-1 shrink-0\" />\r\n            )}\r\n\r\n            {/* Message Bubble */}\r\n            <div className={cn(\r\n                \"p-4 rounded-2xl text-sm leading-relaxed shadow-sm\",\r\n                message.role === 'user'\r\n                    ? \"bg-blue-600 text-white rounded-tr-none\"\r\n                    : \"bg-slate-800 border border-slate-700 text-slate-200 rounded-tl-none\"\r\n            )}>\r\n                {/* User Image Attachments */}\r\n                {message.role === 'user' && message.attachments?.images && message.attachments.images.length > 0 && (\r\n                    <div className=\"mb-3 space-y-2\">\r\n                        {message.attachments.images.map((imageUrl, imgIdx) => (\r\n                            <ImagePreview\r\n                                key={imgIdx}\r\n                                src={imageUrl}\r\n                                alt=\"Uploaded image\"\r\n                                onClick={onImageClick}\r\n                                className=\"w-full rounded-lg\"\r\n                            />\r\n                        ))}\r\n                    </div>\r\n                )}\r\n\r\n                {/* Message Content */}\r\n                <div className=\"prose prose-invert prose-p:my-1 prose-pre:bg-slate-900 prose-pre:p-2 prose-pre:rounded-lg max-w-none break-words\">\r\n                    {text ? (\r\n                        <ReactMarkdown\r\n                            urlTransform={(value) => value}\r\n                            components={markdownComponents}\r\n                        >\r\n                            {text}\r\n                        </ReactMarkdown>\r\n                    ) : null}\r\n\r\n                    {/* Tool Invocations */}\r\n                    {message.toolInvocations?.map((tool, toolIdx) => (\r\n                        <ToolStatus\r\n                            key={toolIdx}\r\n                            tool={tool}\r\n                            onImageClick={onImageClick}\r\n                        />\r\n                    ))}\r\n                </div>\r\n            </div>\r\n        </motion.div>\r\n    );\r\n});\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AA6BO,MAAM,4BAAc,GAAA,wKAAK,CAAC,IAAI,SAAmB,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,YAAY,EAAE;;IACrF,yEAAyE;IACzE,MAAM,iBAAiB,CAAC;QACpB,IAAI,IAAI,KAAK,IAAI,MAAM,OAAO,CAAC,IAAI,KAAK,GAAG;YACvC,OAAO,IAAI,KAAK,CACX,MAAM,CAAC,CAAC,OAAc,KAAK,IAAI,KAAK,QACpC,GAAG,CAAC,CAAC,OAAc,KAAK,IAAI,EAC5B,IAAI,CAAC;QACd;QACA,OAAO,IAAI,OAAO,IAAI;IAC1B;IAEA,MAAM,OAAO,eAAe;IAC5B,MAAM,WAAW,QAAQ,eAAe,EAAE,UAAU,IAAI;IAExD,4EAA4E;IAC5E,MAAM,qBAAqB,IAAA,wKAAO;mDAAC,IAAM,CAAC;gBACtC,GAAG;+DAAE,CAAC,EAAE,IAAI,EAAE,GAAG,OAAY,GAAK,MAAM,GAAG,iBACvC,6LAAC,oKAAY;4BACT,KAAK,OAAO,MAAM,GAAG;4BACrB,KAAK,OAAO,MAAM,GAAG,IAAI;4BACzB,SAAS;;;;;uEAEb;;YACR,CAAC;kDAAG;QAAC;KAAa;IAElB,oCAAoC;IACpC,IAAI,QAAQ,IAAI,KAAK,eAAe,CAAC,QAAQ,CAAC,UAAU;QACpD,OAAO;IACX;IAEA,qBACI,6LAAC,uMAAM,CAAC,GAAG;QAEP,SAAS;YAAE,SAAS;YAAG,GAAG;QAAG;QAC7B,SAAS;YAAE,SAAS;YAAG,GAAG;QAAE;QAC5B,WAAW,IAAA,mIAAE,EACT,0BACA,QAAQ,IAAI,KAAK,SAAS,6BAA6B;;YAI1D,QAAQ,IAAI,KAAK,uBACd,6LAAC;gBAAI,WAAU;0BACX,cAAA,6LAAC,6MAAI;oBAAC,WAAU;;;;;;;;;;yEAGpB,6LAAC,0JAAe;gBAAC,WAAU;;;;;;0BAI/B,6LAAC;gBAAI,WAAW,IAAA,mIAAE,EACd,qDACA,QAAQ,IAAI,KAAK,SACX,2CACA;;oBAGL,QAAQ,IAAI,KAAK,UAAU,QAAQ,WAAW,EAAE,UAAU,QAAQ,WAAW,CAAC,MAAM,CAAC,MAAM,GAAG,mBAC3F,6LAAC;wBAAI,WAAU;kCACV,QAAQ,WAAW,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,UAAU,uBACvC,6LAAC,oKAAY;gCAET,KAAK;gCACL,KAAI;gCACJ,SAAS;gCACT,WAAU;+BAJL;;;;;;;;;;kCAWrB,6LAAC;wBAAI,WAAU;;4BACV,qBACG,6LAAC,sMAAa;gCACV,cAAc,CAAC,QAAU;gCACzB,YAAY;0CAEX;;;;;2EAEL;4BAGH,QAAQ,eAAe,EAAE,IAAI,CAAC,MAAM,wBACjC,6LAAC,gKAAU;oCAEP,MAAM;oCACN,cAAc;mCAFT;;;;;;;;;;;;;;;;;;OArDhB,QAAQ,EAAE,IAAI;;;;;AA8D/B"}},
    {"offset": {"line": 3641, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User01/.gemini/antigravity/scratch/renovation-next/web_client/components/chat/ChatMessages.tsx"],"sourcesContent":["import React, { RefObject } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport ArchitectAvatar from '@/components/ArchitectAvatar';\r\nimport { MessageItem } from '@/components/chat/MessageItem';\r\n\r\n// ✅ Message interface compatible with AI SDK\r\ninterface Message {\r\n    id: string;\r\n    role: string;\r\n    content: string;\r\n    toolInvocations?: Array<{\r\n        toolCallId: string;\r\n        toolName: string;\r\n        state: 'call' | 'result';\r\n        args?: any;\r\n        result?: any;\r\n    }>;\r\n    attachments?: {\r\n        images?: string[];\r\n    };\r\n}\r\n\r\ninterface ChatMessagesProps {\r\n    messages: Message[];\r\n    isLoading: boolean;\r\n    typingMessage: string;\r\n    onImageClick: (imageUrl: string) => void;\r\n    messagesContainerRef: RefObject<HTMLDivElement | null>;\r\n    messagesEndRef: RefObject<HTMLDivElement | null>;\r\n}\r\n\r\n/**\r\n * Chat messages list component - Refactored for maintainability\r\n * ✅ Delegates individual message rendering to MessageItem\r\n * ✅ Reduced cyclomatic complexity by extracting tool status logic\r\n */\r\nconst scrollStyle = { WebkitOverflowScrolling: 'touch' as const };\r\n\r\nconst ChatMessagesComponent = ({\r\n    messages,\r\n    isLoading,\r\n    typingMessage,\r\n    onImageClick,\r\n    messagesContainerRef,\r\n    messagesEndRef\r\n}: ChatMessagesProps) => {\r\n    return (\r\n        <div\r\n            ref={messagesContainerRef}\r\n            className=\"flex-1 overflow-y-auto p-4 space-y-6 scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-transparent overscroll-contain touch-pan-y\"\r\n            style={scrollStyle}\r\n        >\r\n            {/* Render all messages */}\r\n            {messages.map((msg, idx) => (\r\n                <MessageItem\r\n                    key={msg.id || idx}\r\n                    message={msg}\r\n                    index={idx}\r\n                    onImageClick={onImageClick}\r\n                />\r\n            ))}\r\n\r\n            {/* Loading indicator */}\r\n            {isLoading && (\r\n                <motion.div\r\n                    initial={{ opacity: 0, y: 10 }}\r\n                    animate={{ opacity: 1, y: 0 }}\r\n                    className=\"flex gap-3\"\r\n                >\r\n                    <ArchitectAvatar className=\"w-8 h-8 shrink-0\" />\r\n                    <div className=\"bg-slate-800 border border-slate-700 p-4 rounded-2xl rounded-tl-none\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"flex gap-1\">\r\n                                <span className=\"w-2 h-2 bg-blue-500 rounded-full animate-bounce [animation-delay:-0.3s]\" />\r\n                                <span className=\"w-2 h-2 bg-blue-500 rounded-full animate-bounce [animation-delay:-0.15s]\" />\r\n                                <span className=\"w-2 h-2 bg-blue-500 rounded-full animate-bounce\" />\r\n                            </div>\r\n                            <motion.span\r\n                                key={typingMessage}\r\n                                initial={{ opacity: 0 }}\r\n                                animate={{ opacity: 1 }}\r\n                                className=\"text-xs text-slate-400 font-medium\"\r\n                            >\r\n                                {typingMessage}\r\n                            </motion.span>\r\n                        </div>\r\n                    </div>\r\n                </motion.div>\r\n            )}\r\n\r\n            <div ref={messagesEndRef} />\r\n        </div>\r\n    );\r\n};\r\n\r\n// ✅ Memoize component to prevent re-renders when props haven't changed\r\nexport const ChatMessages = React.memo(ChatMessagesComponent);\r\n\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;;;;;;AA4BA;;;;CAIC,GACD,MAAM,cAAc;IAAE,yBAAyB;AAAiB;AAEhE,MAAM,wBAAwB,CAAC,EAC3B,QAAQ,EACR,SAAS,EACT,aAAa,EACb,YAAY,EACZ,oBAAoB,EACpB,cAAc,EACE;IAChB,qBACI,6LAAC;QACG,KAAK;QACL,WAAU;QACV,OAAO;;YAGN,SAAS,GAAG,CAAC,CAAC,KAAK,oBAChB,6LAAC,kKAAW;oBAER,SAAS;oBACT,OAAO;oBACP,cAAc;mBAHT,IAAI,EAAE,IAAI;;;;;YAQtB,2BACG,6LAAC,uMAAM,CAAC,GAAG;gBACP,SAAS;oBAAE,SAAS;oBAAG,GAAG;gBAAG;gBAC7B,SAAS;oBAAE,SAAS;oBAAG,GAAG;gBAAE;gBAC5B,WAAU;;kCAEV,6LAAC,0JAAe;wBAAC,WAAU;;;;;;kCAC3B,6LAAC;wBAAI,WAAU;kCACX,cAAA,6LAAC;4BAAI,WAAU;;8CACX,6LAAC;oCAAI,WAAU;;sDACX,6LAAC;4CAAK,WAAU;;;;;;sDAChB,6LAAC;4CAAK,WAAU;;;;;;sDAChB,6LAAC;4CAAK,WAAU;;;;;;;;;;;;8CAEpB,6LAAC,uMAAM,CAAC,IAAI;oCAER,SAAS;wCAAE,SAAS;oCAAE;oCACtB,SAAS;wCAAE,SAAS;oCAAE;oCACtB,WAAU;8CAET;mCALI;;;;;;;;;;;;;;;;;;;;;;0BAYzB,6LAAC;gBAAI,KAAK;;;;;;;;;;;;AAGtB;KAvDM;AA0DC,MAAM,6BAAe,wKAAK,CAAC,IAAI,CAAC"}},
    {"offset": {"line": 3788, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User01/.gemini/antigravity/scratch/renovation-next/web_client/components/VoiceRecorder.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\r\nimport { Mic, Square, Loader2 } from 'lucide-react';\r\n\r\ninterface VoiceRecorderProps {\r\n    onRecordingComplete: (file: File) => void;\r\n    disabled?: boolean;\r\n    maxDurationSeconds?: number;\r\n}\r\n\r\nexport const VoiceRecorder: React.FC<VoiceRecorderProps> = ({\r\n    onRecordingComplete,\r\n    disabled,\r\n    maxDurationSeconds = 60\r\n}) => {\r\n    const [isRecording, setIsRecording] = useState(false);\r\n    const [isProcessing, setIsProcessing] = useState(false);\r\n    const [timeLeft, setTimeLeft] = useState(maxDurationSeconds);\r\n\r\n    const mediaRecorderRef = useRef<MediaRecorder | null>(null);\r\n    const chunksRef = useRef<Blob[]>([]);\r\n    const timerRef = useRef<NodeJS.Timeout | null>(null);\r\n\r\n    useEffect(() => {\r\n        return () => {\r\n            if (timerRef.current) clearInterval(timerRef.current);\r\n        };\r\n    }, []);\r\n\r\n    const startRecording = async () => {\r\n        try {\r\n            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\r\n            const mediaRecorder = new MediaRecorder(stream);\r\n            mediaRecorderRef.current = mediaRecorder;\r\n            chunksRef.current = [];\r\n\r\n            setTimeLeft(maxDurationSeconds);\r\n\r\n            timerRef.current = setInterval(() => {\r\n                setTimeLeft((prev) => {\r\n                    if (prev <= 1) {\r\n                        stopRecording();\r\n                        return 0;\r\n                    }\r\n                    return prev - 1;\r\n                });\r\n            }, 1000);\r\n\r\n            mediaRecorder.ondataavailable = (e) => {\r\n                if (e.data.size > 0) chunksRef.current.push(e.data);\r\n            };\r\n\r\n            mediaRecorder.onstop = () => {\r\n                const blob = new Blob(chunksRef.current, { type: 'audio/webm' });\r\n\r\n                if (blob.size > 5 * 1024 * 1024) {\r\n                    alert(\"File audio troppo grande. Riprova con un messaggio più breve.\");\r\n                    setIsProcessing(false);\r\n                    return;\r\n                }\r\n\r\n                const file = new File([blob], 'voice_message.webm', { type: 'audio/webm' });\r\n\r\n                setIsProcessing(false);\r\n                onRecordingComplete(file);\r\n\r\n                stream.getTracks().forEach(track => track.stop());\r\n                if (timerRef.current) clearInterval(timerRef.current);\r\n            };\r\n\r\n            mediaRecorder.start();\r\n            setIsRecording(true);\r\n        } catch (err) {\r\n            console.error(\"Errore microfono:\", err);\r\n            alert(\"Impossibile accedere al microfono.\");\r\n        }\r\n    };\r\n\r\n    const stopRecording = () => {\r\n        if (mediaRecorderRef.current && mediaRecorderRef.current.state !== 'inactive') {\r\n            setIsProcessing(true);\r\n            mediaRecorderRef.current.stop();\r\n            setIsRecording(false);\r\n            if (timerRef.current) clearInterval(timerRef.current);\r\n        }\r\n    };\r\n\r\n    const formatTime = (seconds: number) => {\r\n        const mins = Math.floor(seconds / 60);\r\n        const secs = seconds % 60;\r\n        return `${mins}:${secs < 10 ? '0' : ''}${secs}`;\r\n    };\r\n\r\n    return (\r\n        <div className=\"relative flex items-center\">\r\n            {isRecording && (\r\n                <span className=\"absolute -top-10 left-1/2 transform -translate-x-1/2 bg-black/80 backdrop-blur text-white text-xs px-2 py-1 rounded shadow animate-pulse border border-white/10\">\r\n                    {formatTime(timeLeft)}\r\n                </span>\r\n            )}\r\n\r\n            <button\r\n                type=\"button\"\r\n                onClick={isRecording ? stopRecording : startRecording}\r\n                disabled={disabled || isProcessing}\r\n                className={`p-2 rounded-full transition-all duration-200 flex items-center justify-center relative\r\n            ${isRecording\r\n                        ? 'bg-red-500 hover:bg-red-600 text-white ring-4 ring-red-500/30'\r\n                        : 'bg-slate-800 text-slate-400 hover:text-white hover:bg-slate-700 border border-white/5'\r\n                    }\r\n            ${disabled ? 'opacity-50 cursor-not-allowed' : ''}\r\n          `}\r\n                title={isRecording ? \"Ferma ora\" : \"Registra vocale (Max 60s)\"}\r\n            >\r\n                {isProcessing ? (\r\n                    <Loader2 className=\"w-5 h-5 animate-spin\" />\r\n                ) : isRecording ? (\r\n                    <Square className=\"w-5 h-5 fill-current\" />\r\n                ) : (\r\n                    <Mic className=\"w-5 h-5\" />\r\n                )}\r\n            </button>\r\n        </div>\r\n    );\r\n};\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AAAA;AAAA;;;;;AAQO,MAAM,gBAA8C,CAAC,EACxD,mBAAmB,EACnB,QAAQ,EACR,qBAAqB,EAAE,EAC1B;;IACG,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,yKAAQ,EAAC;IAC/C,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,yKAAQ,EAAC;IACjD,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAC;IAEzC,MAAM,mBAAmB,IAAA,uKAAM,EAAuB;IACtD,MAAM,YAAY,IAAA,uKAAM,EAAS,EAAE;IACnC,MAAM,WAAW,IAAA,uKAAM,EAAwB;IAE/C,IAAA,0KAAS;mCAAC;YACN;2CAAO;oBACH,IAAI,SAAS,OAAO,EAAE,cAAc,SAAS,OAAO;gBACxD;;QACJ;kCAAG,EAAE;IAEL,MAAM,iBAAiB;QACnB,IAAI;YACA,MAAM,SAAS,MAAM,UAAU,YAAY,CAAC,YAAY,CAAC;gBAAE,OAAO;YAAK;YACvE,MAAM,gBAAgB,IAAI,cAAc;YACxC,iBAAiB,OAAO,GAAG;YAC3B,UAAU,OAAO,GAAG,EAAE;YAEtB,YAAY;YAEZ,SAAS,OAAO,GAAG,YAAY;gBAC3B,YAAY,CAAC;oBACT,IAAI,QAAQ,GAAG;wBACX;wBACA,OAAO;oBACX;oBACA,OAAO,OAAO;gBAClB;YACJ,GAAG;YAEH,cAAc,eAAe,GAAG,CAAC;gBAC7B,IAAI,EAAE,IAAI,CAAC,IAAI,GAAG,GAAG,UAAU,OAAO,CAAC,IAAI,CAAC,EAAE,IAAI;YACtD;YAEA,cAAc,MAAM,GAAG;gBACnB,MAAM,OAAO,IAAI,KAAK,UAAU,OAAO,EAAE;oBAAE,MAAM;gBAAa;gBAE9D,IAAI,KAAK,IAAI,GAAG,IAAI,OAAO,MAAM;oBAC7B,MAAM;oBACN,gBAAgB;oBAChB;gBACJ;gBAEA,MAAM,OAAO,IAAI,KAAK;oBAAC;iBAAK,EAAE,sBAAsB;oBAAE,MAAM;gBAAa;gBAEzE,gBAAgB;gBAChB,oBAAoB;gBAEpB,OAAO,SAAS,GAAG,OAAO,CAAC,CAAA,QAAS,MAAM,IAAI;gBAC9C,IAAI,SAAS,OAAO,EAAE,cAAc,SAAS,OAAO;YACxD;YAEA,cAAc,KAAK;YACnB,eAAe;QACnB,EAAE,OAAO,KAAK;YACV,QAAQ,KAAK,CAAC,qBAAqB;YACnC,MAAM;QACV;IACJ;IAEA,MAAM,gBAAgB;QAClB,IAAI,iBAAiB,OAAO,IAAI,iBAAiB,OAAO,CAAC,KAAK,KAAK,YAAY;YAC3E,gBAAgB;YAChB,iBAAiB,OAAO,CAAC,IAAI;YAC7B,eAAe;YACf,IAAI,SAAS,OAAO,EAAE,cAAc,SAAS,OAAO;QACxD;IACJ;IAEA,MAAM,aAAa,CAAC;QAChB,MAAM,OAAO,KAAK,KAAK,CAAC,UAAU;QAClC,MAAM,OAAO,UAAU;QACvB,OAAO,GAAG,KAAK,CAAC,EAAE,OAAO,KAAK,MAAM,KAAK,MAAM;IACnD;IAEA,qBACI,6LAAC;QAAI,WAAU;;YACV,6BACG,6LAAC;gBAAK,WAAU;0BACX,WAAW;;;;;;0BAIpB,6LAAC;gBACG,MAAK;gBACL,SAAS,cAAc,gBAAgB;gBACvC,UAAU,YAAY;gBACtB,WAAW,CAAC;YAChB,EAAE,cACY,kEACA,wFACL;YACT,EAAE,WAAW,kCAAkC,GAAG;UACpD,CAAC;gBACK,OAAO,cAAc,cAAc;0BAElC,6BACG,6LAAC,+NAAO;oBAAC,WAAU;;;;;+DACnB,4BACA,6LAAC,mNAAM;oBAAC,WAAU;;;;;6EAElB,6LAAC,0MAAG;oBAAC,WAAU;;;;;;;;;;;;;;;;;AAKnC;GAlHa;KAAA"}},
    {"offset": {"line": 3940, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User01/.gemini/antigravity/scratch/renovation-next/web_client/components/chat/ChatInput.tsx"],"sourcesContent":["import React, { RefObject } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Send, Paperclip, Loader2 } from 'lucide-react';\r\nimport { VoiceRecorder } from '@/components/VoiceRecorder';\r\nimport { cn } from '@/lib/utils';\r\n\r\ninterface ChatInputProps {\r\n    inputValue: string;\r\n    setInputValue: (value: string) => void;\r\n    onSubmit: (e?: React.FormEvent) => void;\r\n    isLoading: boolean;\r\n    isUploading?: boolean; // New prop\r\n    uploadStatus?: string; // New prop\r\n    selectedImages: string[];\r\n    onFileSelect: (e: React.ChangeEvent<HTMLInputElement>) => void;\r\n    onVoiceRecorded: (file: File) => void;\r\n    onScrollToBottom: () => void;\r\n    fileInputRef: RefObject<HTMLInputElement | null>;\r\n}\r\n\r\n/**\r\n * Chat input component with textarea, file upload, voice recorder, and send button\r\n * Extracted from ChatWidget.tsx (lines 561-581)\r\n */\r\nexport function ChatInput({\r\n    inputValue,\r\n    setInputValue,\r\n    onSubmit,\r\n    isLoading,\r\n    isUploading = false,\r\n    uploadStatus = '',\r\n    selectedImages,\r\n    onFileSelect,\r\n    onVoiceRecorded,\r\n    onScrollToBottom,\r\n    fileInputRef\r\n}: ChatInputProps) {\r\n    return (\r\n        <div\r\n            className=\"px-4 border-t border-white/10 backdrop-blur-md flex-shrink-0 w-full\"\r\n            style={{ backgroundColor: '#0b1120', paddingTop: '10px', paddingBottom: 'calc(env(safe-area-inset-bottom) + 10px)' }}\r\n        >\r\n            {/* Upload Status Indicator */}\r\n            {uploadStatus && (\r\n                <div className=\"text-xs text-blue-400 mb-1 ml-1 animate-pulse font-medium\">\r\n                    {uploadStatus}\r\n                </div>\r\n            )}\r\n\r\n            <div className=\"flex gap-2 items-end max-w-full\">\r\n                <Button\r\n                    variant=\"ghost\"\r\n                    size=\"icon\"\r\n                    className=\"text-slate-400 hover:text-white shrink-0 relative\"\r\n                    onClick={() => fileInputRef.current?.click()}\r\n                    disabled={isLoading || isUploading}\r\n                >\r\n                    {isUploading ? (\r\n                        <Loader2 className=\"w-5 h-5 animate-spin text-blue-500\" />\r\n                    ) : (\r\n                        <Paperclip className=\"w-5 h-5\" />\r\n                    )}\r\n                </Button>\r\n\r\n                <input\r\n                    type=\"file\"\r\n                    ref={fileInputRef}\r\n                    className=\"hidden\"\r\n                    accept=\"image/*\"\r\n                    onChange={onFileSelect}\r\n                    multiple\r\n                />\r\n\r\n                {/* ✅ NEW: Optimistic Image Preview (before sending) */}\r\n                {selectedImages.length > 0 && (\r\n                    <div className=\"mb-2 flex flex-wrap gap-2\">\r\n                        {selectedImages.map((img, idx) => (\r\n                            <div\r\n                                key={idx}\r\n                                className=\"relative group w-20 h-20 rounded-lg overflow-hidden border border-blue-500/30 shadow-lg\"\r\n                            >\r\n                                <img\r\n                                    src={img}\r\n                                    alt={`Selected ${idx + 1}`}\r\n                                    className=\"w-full h-full object-cover\"\r\n                                />\r\n                                {/* Optional: Add remove button per image\r\n                                <button\r\n                                    className=\"absolute top-1 right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity\"\r\n                                    onClick={() => removeImage(idx)}\r\n                                >\r\n                                    <X className=\"w-3 h-3 text-white\" />\r\n                                </button>\r\n                                */}\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n\r\n                <div className=\"flex-1 bg-slate-950 border border-slate-800 rounded-2xl flex items-center p-1 focus-within:border-blue-500/50 transition-colors min-w-0\">\r\n                    <textarea\r\n                        value={inputValue}\r\n                        onChange={(e) => setInputValue(e.target.value)}\r\n                        onKeyDown={(e) => {\r\n                            if (e.key === 'Enter' && !e.shiftKey) {\r\n                                e.preventDefault();\r\n                                onSubmit(e);\r\n                            }\r\n                        }}\r\n                        onFocus={() => setTimeout(() => onScrollToBottom(), 100)}\r\n                        placeholder=\"Descrivi cosa vuoi ristrutturare...\"\r\n                        className=\"w-full bg-transparent text-white text-[16px] px-3 py-2 max-h-24 min-h-[44px] focus:outline-none resize-none scrollbar-hide block\"\r\n                        rows={1}\r\n                        disabled={isLoading}\r\n                    />\r\n                    <div className=\"flex items-center gap-1 pr-1 shrink-0\">\r\n                        <VoiceRecorder onRecordingComplete={onVoiceRecorded} disabled={isLoading} />\r\n                    </div>\r\n                </div>\r\n\r\n                <Button\r\n                    onClick={() => onSubmit()}\r\n                    disabled={isLoading || (!inputValue.trim() && selectedImages.length === 0)}\r\n                    className={cn(\r\n                        \"rounded-xl transition-all duration-300 shrink-0\",\r\n                        inputValue.trim() || selectedImages.length > 0\r\n                            ? \"bg-blue-600 hover:bg-blue-500 text-white shadow-lg shadow-blue-500/20\"\r\n                            : \"bg-slate-800 text-slate-500\"\r\n                    )}\r\n                    size=\"icon\"\r\n                >\r\n                    <Send className=\"w-5 h-5\" />\r\n                </Button>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AACA;AACA;AAAA;AAAA;AACA;AACA;;;;;;AAoBO,SAAS,UAAU,EACtB,UAAU,EACV,aAAa,EACb,QAAQ,EACR,SAAS,EACT,cAAc,KAAK,EACnB,eAAe,EAAE,EACjB,cAAc,EACd,YAAY,EACZ,eAAe,EACf,gBAAgB,EAChB,YAAY,EACC;IACb,qBACI,6LAAC;QACG,WAAU;QACV,OAAO;YAAE,iBAAiB;YAAW,YAAY;YAAQ,eAAe;QAA2C;;YAGlH,8BACG,6LAAC;gBAAI,WAAU;0BACV;;;;;;0BAIT,6LAAC;gBAAI,WAAU;;kCACX,6LAAC,sJAAM;wBACH,SAAQ;wBACR,MAAK;wBACL,WAAU;wBACV,SAAS,IAAM,aAAa,OAAO,EAAE;wBACrC,UAAU,aAAa;kCAEtB,4BACG,6LAAC,+NAAO;4BAAC,WAAU;;;;;iDAEnB,6LAAC,4NAAS;4BAAC,WAAU;;;;;;;;;;;kCAI7B,6LAAC;wBACG,MAAK;wBACL,KAAK;wBACL,WAAU;wBACV,QAAO;wBACP,UAAU;wBACV,QAAQ;;;;;;oBAIX,eAAe,MAAM,GAAG,mBACrB,6LAAC;wBAAI,WAAU;kCACV,eAAe,GAAG,CAAC,CAAC,KAAK,oBACtB,6LAAC;gCAEG,WAAU;0CAEV,cAAA,6LAAC;oCACG,KAAK;oCACL,KAAK,CAAC,SAAS,EAAE,MAAM,GAAG;oCAC1B,WAAU;;;;;;+BANT;;;;;;;;;;kCAqBrB,6LAAC;wBAAI,WAAU;;0CACX,6LAAC;gCACG,OAAO;gCACP,UAAU,CAAC,IAAM,cAAc,EAAE,MAAM,CAAC,KAAK;gCAC7C,WAAW,CAAC;oCACR,IAAI,EAAE,GAAG,KAAK,WAAW,CAAC,EAAE,QAAQ,EAAE;wCAClC,EAAE,cAAc;wCAChB,SAAS;oCACb;gCACJ;gCACA,SAAS,IAAM,WAAW,IAAM,oBAAoB;gCACpD,aAAY;gCACZ,WAAU;gCACV,MAAM;gCACN,UAAU;;;;;;0CAEd,6LAAC;gCAAI,WAAU;0CACX,cAAA,6LAAC,8JAAa;oCAAC,qBAAqB;oCAAiB,UAAU;;;;;;;;;;;;;;;;;kCAIvE,6LAAC,sJAAM;wBACH,SAAS,IAAM;wBACf,UAAU,aAAc,CAAC,WAAW,IAAI,MAAM,eAAe,MAAM,KAAK;wBACxE,WAAW,IAAA,mIAAE,EACT,mDACA,WAAW,IAAI,MAAM,eAAe,MAAM,GAAG,IACvC,0EACA;wBAEV,MAAK;kCAEL,cAAA,6LAAC,6MAAI;4BAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;AAKpC;KAhHgB"}},
    {"offset": {"line": 4118, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User01/.gemini/antigravity/scratch/renovation-next/web_client/components/chat/ChatToggleButton.tsx"],"sourcesContent":["import React from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { Button } from '@/components/ui/button';\r\nimport { X } from 'lucide-react';\r\nimport { cn } from '@/lib/utils';\r\n\r\ninterface ChatToggleButtonProps {\r\n    isOpen: boolean;\r\n    onClick: () => void;\r\n}\r\n\r\n/**\r\n * Floating toggle button component with avatar animation\r\n * Extracted from ChatWidget.tsx (lines 486-499)\r\n */\r\nexport function ChatToggleButton({ isOpen, onClick }: ChatToggleButtonProps) {\r\n    return (\r\n        <motion.div initial={{ opacity: 0, scale: 0.8 }} animate={{ opacity: 1, scale: 1 }}>\r\n            <Button\r\n                onClick={onClick}\r\n                size=\"icon\"\r\n                aria-label={isOpen ? \"Chiudi chat\" : \"Apri chat\"}\r\n                className={cn(\r\n                    \"w-32 h-28 rounded-full transition-all duration-300 relative flex items-center justify-center !overflow-visible\",\r\n                    isOpen\r\n                        ? \"bg-slate-800 text-white shadow-2xl border border-white/10 w-16 h-16\"\r\n                        : \"bg-transparent shadow-none border-none hover:scale-105\"\r\n                )}\r\n            >\r\n                {isOpen ? (\r\n                    <X className=\"w-8 h-8\" />\r\n                ) : (\r\n                    <>\r\n                        <div className=\"relative w-full h-full flex items-center justify-center !overflow-visible\">\r\n                            <img\r\n                                src=\"/assets/syd_final_diecut.png\"\r\n                                alt=\"Chat\"\r\n                                className=\"w-full h-full max-w-none object-contain drop-shadow-xl transform transition-transform duration-300\"\r\n                            />\r\n                        </div>\r\n                        <span className=\"absolute top-1 right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-slate-900 animate-pulse z-10\" />\r\n                    </>\r\n                )}\r\n            </Button>\r\n        </motion.div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;AACA;;;;;;AAWO,SAAS,iBAAiB,EAAE,MAAM,EAAE,OAAO,EAAyB;IACvE,qBACI,6LAAC,uMAAM,CAAC,GAAG;QAAC,SAAS;YAAE,SAAS;YAAG,OAAO;QAAI;QAAG,SAAS;YAAE,SAAS;YAAG,OAAO;QAAE;kBAC7E,cAAA,6LAAC,sJAAM;YACH,SAAS;YACT,MAAK;YACL,cAAY,SAAS,gBAAgB;YACrC,WAAW,IAAA,mIAAE,EACT,kHACA,SACM,wEACA;sBAGT,uBACG,6LAAC,oMAAC;gBAAC,WAAU;;;;;qCAEb;;kCACI,6LAAC;wBAAI,WAAU;kCACX,cAAA,6LAAC;4BACG,KAAI;4BACJ,KAAI;4BACJ,WAAU;;;;;;;;;;;kCAGlB,6LAAC;wBAAK,WAAU;;;;;;;;;;;;;;;;;;AAMxC;KA/BgB"}},
    {"offset": {"line": 4201, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User01/.gemini/antigravity/scratch/renovation-next/web_client/components/chat/WelcomeBadge.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { X } from 'lucide-react';\r\n\r\ninterface WelcomeBadgeProps {\r\n    isOpen: boolean;\r\n    onOpenChat: () => void;\r\n}\r\n\r\n/**\r\n * Welcome badge component with typewriter effect\r\n * Extracted from ChatWidget.tsx (lines 403-484)\r\n */\r\nexport function WelcomeBadge({ isOpen, onOpenChat }: WelcomeBadgeProps) {\r\n    const [showWelcomeBadge, setShowWelcomeBadge] = useState(false);\r\n    const [typewriterText, setTypewriterText] = useState('');\r\n    const fullMessage = \"Ciao, sono SYD! Posso aiutarti con il tuo progetto?\";\r\n\r\n    // Show badge after delay\r\n    useEffect(() => {\r\n        const t = setTimeout(() => !isOpen && setShowWelcomeBadge(true), 3000);\r\n        return () => clearTimeout(t);\r\n    }, [isOpen]);\r\n\r\n    // Hide when chat opens\r\n    useEffect(() => {\r\n        if (isOpen) setShowWelcomeBadge(false);\r\n    }, [isOpen]);\r\n\r\n    // Typewriter effect\r\n    useEffect(() => {\r\n        if (!showWelcomeBadge || isOpen) {\r\n            setTypewriterText('');\r\n            return;\r\n        }\r\n\r\n        let i = 0;\r\n        const interval = setInterval(() => {\r\n            if (i < fullMessage.length) {\r\n                setTypewriterText(fullMessage.slice(0, i + 1));\r\n                i++;\r\n            } else {\r\n                clearInterval(interval);\r\n                setTimeout(() => setShowWelcomeBadge(false), 6000);\r\n            }\r\n        }, 50);\r\n\r\n        return () => clearInterval(interval);\r\n    }, [showWelcomeBadge, isOpen]);\r\n\r\n    return (\r\n        <AnimatePresence>\r\n            {showWelcomeBadge && !isOpen && (\r\n                <motion.div\r\n                    initial={{ opacity: 0, x: 20, scale: 0.8 }}\r\n                    animate={{ opacity: 1, x: 0, scale: 1 }}\r\n                    exit={{ opacity: 0, x: 10, scale: 0.8 }}\r\n                    className=\"backdrop-blur-2xl text-white px-3 py-5 rounded-2xl shadow-2xl shadow-blue-400/40 border-2 border-white/40 flex flex-col gap-0 relative mr-1 cursor-pointer hover:shadow-blue-300/60 hover:scale-105 hover:border-white/60 transition-all duration-300 w-40\"\r\n                    onClick={onOpenChat}\r\n                    style={{\r\n                        background: 'linear-gradient(135deg, rgba(255,255,255,0.25) 0%, rgba(255,255,255,0.15) 100%)',\r\n                        boxShadow: 'inset 0 1px 0 0 rgba(255,255,255,0.3), 0 20px 40px -10px rgba(59,130,246,0.4)'\r\n                    }}\r\n                >\r\n                    <p className=\"text-xs text-white font-medium leading-relaxed text-center drop-shadow-sm min-h-[50px] flex items-center justify-center\">\r\n                        {typewriterText}\r\n                        {typewriterText.length < fullMessage.length && (\r\n                            <span className=\"inline-block w-0.5 h-3.5 bg-white ml-0.5 animate-pulse\"></span>\r\n                        )}\r\n                    </p>\r\n                    <div\r\n                        className=\"absolute -right-1.5 top-1/2 -translate-y-1/2 w-3 h-3 backdrop-blur-md rotate-45 border-r-2 border-t-2 border-white/40\"\r\n                        style={{ background: 'rgba(255,255,255,0.2)' }}\r\n                    ></div>\r\n                    <button\r\n                        onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            setShowWelcomeBadge(false);\r\n                        }}\r\n                        aria-label=\"Chiudi\"\r\n                        className=\"absolute -top-2 -right-2 bg-slate-200 hover:bg-slate-300 text-slate-600 rounded-full p-0.5 transition-colors\"\r\n                    >\r\n                        <X className=\"w-3 h-3\" />\r\n                    </button>\r\n                </motion.div>\r\n            )}\r\n        </AnimatePresence>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AAAA;AACA;;;;;;AAWO,SAAS,aAAa,EAAE,MAAM,EAAE,UAAU,EAAqB;;IAClE,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,yKAAQ,EAAC;IACzD,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,yKAAQ,EAAC;IACrD,MAAM,cAAc;IAEpB,yBAAyB;IACzB,IAAA,0KAAS;kCAAC;YACN,MAAM,IAAI;4CAAW,IAAM,CAAC,UAAU,oBAAoB;2CAAO;YACjE;0CAAO,IAAM,aAAa;;QAC9B;iCAAG;QAAC;KAAO;IAEX,uBAAuB;IACvB,IAAA,0KAAS;kCAAC;YACN,IAAI,QAAQ,oBAAoB;QACpC;iCAAG;QAAC;KAAO;IAEX,oBAAoB;IACpB,IAAA,0KAAS;kCAAC;YACN,IAAI,CAAC,oBAAoB,QAAQ;gBAC7B,kBAAkB;gBAClB;YACJ;YAEA,IAAI,IAAI;YACR,MAAM,WAAW;mDAAY;oBACzB,IAAI,IAAI,YAAY,MAAM,EAAE;wBACxB,kBAAkB,YAAY,KAAK,CAAC,GAAG,IAAI;wBAC3C;oBACJ,OAAO;wBACH,cAAc;wBACd;+DAAW,IAAM,oBAAoB;8DAAQ;oBACjD;gBACJ;kDAAG;YAEH;0CAAO,IAAM,cAAc;;QAC/B;iCAAG;QAAC;QAAkB;KAAO;IAE7B,qBACI,6LAAC,+MAAe;kBACX,oBAAoB,CAAC,wBAClB,6LAAC,uMAAM,CAAC,GAAG;YACP,SAAS;gBAAE,SAAS;gBAAG,GAAG;gBAAI,OAAO;YAAI;YACzC,SAAS;gBAAE,SAAS;gBAAG,GAAG;gBAAG,OAAO;YAAE;YACtC,MAAM;gBAAE,SAAS;gBAAG,GAAG;gBAAI,OAAO;YAAI;YACtC,WAAU;YACV,SAAS;YACT,OAAO;gBACH,YAAY;gBACZ,WAAW;YACf;;8BAEA,6LAAC;oBAAE,WAAU;;wBACR;wBACA,eAAe,MAAM,GAAG,YAAY,MAAM,kBACvC,6LAAC;4BAAK,WAAU;;;;;;;;;;;;8BAGxB,6LAAC;oBACG,WAAU;oBACV,OAAO;wBAAE,YAAY;oBAAwB;;;;;;8BAEjD,6LAAC;oBACG,SAAS,CAAC;wBACN,EAAE,eAAe;wBACjB,oBAAoB;oBACxB;oBACA,cAAW;oBACX,WAAU;8BAEV,cAAA,6LAAC,oMAAC;wBAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;AAMrC;GA3EgB;KAAA"}},
    {"offset": {"line": 4363, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User01/.gemini/antigravity/scratch/renovation-next/web_client/components/chat/ImageLightbox.tsx"],"sourcesContent":["import React from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { Button } from '@/components/ui/button';\r\nimport { X, Send } from 'lucide-react';\r\n\r\ninterface ImageLightboxProps {\r\n    imageUrl: string | null;\r\n    onClose: () => void;\r\n}\r\n\r\n/**\r\n * Image lightbox modal for fullscreen image preview\r\n * Extracted from ChatWidget.tsx (lines 587-600)\r\n */\r\nexport function ImageLightbox({ imageUrl, onClose }: ImageLightboxProps) {\r\n    return (\r\n        <AnimatePresence>\r\n            {imageUrl && (\r\n                <motion.div\r\n                    initial={{ opacity: 0 }}\r\n                    animate={{ opacity: 1 }}\r\n                    exit={{ opacity: 0 }}\r\n                    onClick={onClose}\r\n                    role=\"dialog\"\r\n                    aria-label=\"Anteprima immagine\"\r\n                    className=\"fixed inset-0 z-[120] bg-black/90 backdrop-blur-sm flex items-center justify-center p-4\"\r\n                >\r\n                    <div\r\n                        className=\"relative max-w-5xl w-full max-h-[90vh] flex flex-col items-center\"\r\n                        onClick={e => e.stopPropagation()}\r\n                    >\r\n                        <motion.img\r\n                            initial={{ scale: 0.9, opacity: 0 }}\r\n                            animate={{ scale: 1, opacity: 1 }}\r\n                            src={imageUrl}\r\n                            alt=\"Full preview\"\r\n                            className=\"max-w-full max-h-[80vh] rounded-lg shadow-2xl border border-white/10\"\r\n                        />\r\n                        <div className=\"mt-4 flex gap-4\">\r\n                            <Button\r\n                                onClick={onClose}\r\n                                variant=\"outline\"\r\n                                aria-label=\"Chiudi anteprima\"\r\n                                className=\"border-white/20 text-white hover:bg-white/10\"\r\n                            >\r\n                                <X className=\"w-4 h-4 mr-2\" />\r\n                                Chiudi\r\n                            </Button>\r\n                            <a\r\n                                href={imageUrl}\r\n                                download={`renovation-ai-vision-${Date.now()}.png`}\r\n                                aria-label=\"Scarica immagine\"\r\n                                className=\"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors bg-blue-600 text-white hover:bg-blue-700 h-10 px-4 py-2\"\r\n                            >\r\n                                <Send className=\"w-4 h-4 mr-2 rotate-180\" />\r\n                                Scarica HD\r\n                            </a>\r\n                        </div>\r\n                    </div>\r\n                </motion.div>\r\n            )}\r\n        </AnimatePresence>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AACA;AAAA;AACA;AACA;AAAA;;;;;AAWO,SAAS,cAAc,EAAE,QAAQ,EAAE,OAAO,EAAsB;IACnE,qBACI,6LAAC,+MAAe;kBACX,0BACG,6LAAC,uMAAM,CAAC,GAAG;YACP,SAAS;gBAAE,SAAS;YAAE;YACtB,SAAS;gBAAE,SAAS;YAAE;YACtB,MAAM;gBAAE,SAAS;YAAE;YACnB,SAAS;YACT,MAAK;YACL,cAAW;YACX,WAAU;sBAEV,cAAA,6LAAC;gBACG,WAAU;gBACV,SAAS,CAAA,IAAK,EAAE,eAAe;;kCAE/B,6LAAC,uMAAM,CAAC,GAAG;wBACP,SAAS;4BAAE,OAAO;4BAAK,SAAS;wBAAE;wBAClC,SAAS;4BAAE,OAAO;4BAAG,SAAS;wBAAE;wBAChC,KAAK;wBACL,KAAI;wBACJ,WAAU;;;;;;kCAEd,6LAAC;wBAAI,WAAU;;0CACX,6LAAC,sJAAM;gCACH,SAAS;gCACT,SAAQ;gCACR,cAAW;gCACX,WAAU;;kDAEV,6LAAC,oMAAC;wCAAC,WAAU;;;;;;oCAAiB;;;;;;;0CAGlC,6LAAC;gCACG,MAAM;gCACN,UAAU,CAAC,qBAAqB,EAAE,KAAK,GAAG,GAAG,IAAI,CAAC;gCAClD,cAAW;gCACX,WAAU;;kDAEV,6LAAC,6MAAI;wCAAC,WAAU;;;;;;oCAA4B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAS5E;KAjDgB"}},
    {"offset": {"line": 4490, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User01/.gemini/antigravity/scratch/renovation-next/web_client/components/chat/ChatWidget.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState, useRef, useEffect } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\n\r\n// Hooks\r\nimport { useSessionId } from '@/hooks/useSessionId';\r\nimport { useChatHistory } from '@/hooks/useChatHistory';\r\nimport { useChat } from '@/hooks/useChat';\r\nimport { useImageUpload } from '@/hooks/useImageUpload';\r\nimport { useChatScroll } from '@/hooks/useChatScroll';\r\nimport { useMobileViewport } from '@/hooks/useMobileViewport';\r\nimport { useTypingIndicator } from '@/hooks/useTypingIndicator';\r\n\r\n// Components\r\nimport { ChatHeader } from '@/components/chat/ChatHeader';\r\nimport { ChatMessages } from '@/components/chat/ChatMessages';\r\nimport { ChatInput } from '@/components/chat/ChatInput';\r\nimport { ChatToggleButton } from '@/components/chat/ChatToggleButton';\r\nimport { WelcomeBadge } from '@/components/chat/WelcomeBadge';\r\nimport { ImageLightbox } from '@/components/chat/ImageLightbox';\r\n\r\n/**\r\n * ChatWidget Component (Refactored)\r\n * \r\n * ARCHITECTURE: Orchestrator pattern\r\n * - Uses custom hooks for business logic\r\n * - Composes UI components for presentation\r\n * - Reduced from 604 lines to ~150 lines\r\n * \r\n * Previous implementation used manual fetch with TextDecoder for streaming.\r\n * This refactor maintains the same functionality with improved modularity.\r\n */\r\nexport default function ChatWidget() {\r\n    const [isOpen, setIsOpen] = useState(false);\r\n    const [selectedImage, setSelectedImage] = useState<string | null>(null);\r\n\r\n    // Refs\r\n    const chatContainerRef = useRef<HTMLDivElement>(null);\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n    // Session Management\r\n    const sessionId = useSessionId();\r\n\r\n    // Load conversation history\r\n    const { historyLoaded, historyMessages } = useChatHistory(sessionId);\r\n\r\n    // Chat State & Streaming\r\n    // ✅ CRITICAL: Memoize welcome message to prevent re-render loop\r\n    const welcomeMessage = React.useMemo(() => ({\r\n        id: 'welcome',\r\n        role: 'assistant',\r\n        content: \"Posso aiutarti a:\\n1. 📐 **Creare un Preventivo** dettagliato.\\n2. 🎨 **Visualizzare un Rendering** 3D della tua idea.\\n\\nDa dove iniziamo?\"\r\n    }), []);\r\n\r\n    // ✅ CRITICAL: Stabilize initialMessages array reference\r\n    // Only pass real history to SDK to prevent auto-generation\r\n    const initialChatMessages = React.useMemo(() => {\r\n        // If we have history, use it. Otherwise, pass empty array to SDK\r\n        // (welcome message will be added only for UI display)\r\n        return historyMessages.length > 0 ? historyMessages : [];\r\n    }, [historyMessages]);\r\n\r\n    // ✅ Initialize SDK hook with stable reference\r\n    const chatResponse = useChat(sessionId, initialChatMessages);\r\n    const { messages, isLoading, append, error } = chatResponse;\r\n\r\n    // ✅ Add welcome message ONLY for UI display, if no history exists\r\n    // Memoize to prevent infinite re-render loop\r\n    const displayMessages = React.useMemo(() => {\r\n        if (historyMessages.length > 0) {\r\n            return messages;\r\n        }\r\n        // Only add welcome if we have no history AND no messages from SDK yet\r\n        return messages.length === 0 ? [welcomeMessage] : messages;\r\n    }, [historyMessages.length, messages, welcomeMessage]);\r\n\r\n    // Image Upload (now with persistent Storage URLs)\r\n    // Image Upload (now with persistent Storage URLs)\r\n    const { selectedImages, imageUrls, handleFileSelect, clearImages, isUploading, uploadStatus } = useImageUpload(sessionId);\r\n\r\n    // Scroll Management\r\n    const { messagesContainerRef, messagesEndRef, scrollToBottom } = useChatScroll(displayMessages.length, isOpen);\r\n\r\n    // Mobile Viewport & Body Lock\r\n    const { isMobile } = useMobileViewport(isOpen, chatContainerRef);\r\n\r\n    // Typing Indicator\r\n    const typingMessage = useTypingIndicator(isLoading);\r\n\r\n    // Input State\r\n    const [inputValue, setInputValue] = useState('');\r\n\r\n    // Submit Message Handler\r\n    const submitMessage = (e?: React.FormEvent) => {\r\n        e?.preventDefault();\r\n        if ((!inputValue.trim() && selectedImages.length === 0) || isLoading) return;\r\n\r\n        if (selectedImages.length > 0) {\r\n            append({\r\n                role: 'user',\r\n                content: inputValue,\r\n                // ✅ NEW: Include attachments for immediate preview in chat\r\n                attachments: {\r\n                    images: imageUrls.length > 0 ? imageUrls : selectedImages // Prefer public URLs, fallback to base64\r\n                }\r\n            } as any, {\r\n                body: {\r\n                    images: selectedImages,      // base64 for AI vision\r\n                    imageUrls: imageUrls          // Public URLs for modification mode\r\n                }\r\n            });\r\n            clearImages();\r\n            setInputValue('');\r\n        } else {\r\n            append({\r\n                role: 'user',\r\n                content: inputValue\r\n            });\r\n            setInputValue('');\r\n        }\r\n    };\r\n\r\n    // Voice Recording Handler\r\n    const handleVoiceRecorded = async (file: File) => {\r\n        try {\r\n            // Step 1: Transcribe audio to text using speech-to-text API\r\n            const formData = new FormData();\r\n            formData.append('audio', file);\r\n\r\n            const sttResponse = await fetch('/api/speech-to-text', {\r\n                method: 'POST',\r\n                body: formData,\r\n            });\r\n\r\n            if (!sttResponse.ok) {\r\n                throw new Error('Speech-to-text transcription failed');\r\n            }\r\n\r\n            const { text: transcribedText } = await sttResponse.json();\r\n\r\n            if (transcribedText && transcribedText.trim()) {\r\n                // Step 2: Send transcribed text to chat using append from useChat\r\n                const message: any = {\r\n                    role: 'user',\r\n                    content: `🎤 ${transcribedText}`\r\n                };\r\n\r\n                // ✅ NEW: Include attachments if images are selected\r\n                if (selectedImages.length > 0) {\r\n                    message.attachments = {\r\n                        images: imageUrls.length > 0 ? imageUrls : selectedImages\r\n                    };\r\n                }\r\n\r\n                await append(message, {\r\n                    body: {\r\n                        images: selectedImages,\r\n                        imageUrls: imageUrls\r\n                    }\r\n                });\r\n            } else {\r\n                console.warn('No text transcribed from audio');\r\n            }\r\n        } catch (error) {\r\n            console.error('Voice recording error:', error);\r\n            // Show error to user (optional: add toast notification)\r\n        }\r\n    };\r\n\r\n    // External Triggers (for opening chat from other components)\r\n    useEffect(() => {\r\n        const handleOpenChat = (e: CustomEvent<{ message?: string }>) => {\r\n            setIsOpen(true);\r\n            if (e.detail?.message) {\r\n                setTimeout(() => {\r\n                    append({ role: 'user', content: e.detail.message! });\r\n                }, 500);\r\n            }\r\n        };\r\n        window.addEventListener('OPEN_CHAT_WITH_MESSAGE' as any, handleOpenChat as any);\r\n        return () => window.removeEventListener('OPEN_CHAT_WITH_MESSAGE' as any, handleOpenChat as any);\r\n    }, [append]);\r\n\r\n    // 🛑 CRITICAL: Loading Guard - Moved here to follow Rules of Hooks\r\n    // We only return null for the UI, but hooks above must always run\r\n    if (!historyLoaded) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <>\r\n            {/* Floating Toggle Button Area */}\r\n            <div className=\"fixed bottom-8 right-6 z-50 flex items-center gap-4\">\r\n                <WelcomeBadge isOpen={isOpen} onOpenChat={() => setIsOpen(true)} />\r\n                <ChatToggleButton isOpen={isOpen} onClick={() => setIsOpen(!isOpen)} />\r\n            </div>\r\n\r\n            {/* Chat Window */}\r\n            <AnimatePresence>\r\n                {isOpen && (\r\n                    <>\r\n                        {/* Backdrop */}\r\n                        <motion.div\r\n                            key=\"backdrop\"\r\n                            initial={{ opacity: 0 }}\r\n                            animate={{ opacity: 1 }}\r\n                            exit={{ opacity: 0 }}\r\n                            className=\"fixed inset-0 z-[90] bg-[#0f172a] touch-none md:bg-black/40 md:backdrop-blur-sm transition-all duration-300\"\r\n                        />\r\n\r\n                        {/* Chat Container */}\r\n                        <motion.div\r\n                            key=\"chat-window\"\r\n                            initial={{ opacity: 0, y: 50, scale: 0.95 }}\r\n                            animate={{ opacity: 1, y: 0, scale: 1 }}\r\n                            exit={{ opacity: 0, y: 50, scale: 0.95 }}\r\n                            transition={{ duration: 0.2 }}\r\n                            ref={chatContainerRef}\r\n                            style={{ height: isMobile ? '100dvh' : undefined, top: isMobile ? 0 : undefined }}\r\n                            className=\"fixed inset-0 md:inset-auto md:bottom-4 md:right-6 w-full md:w-[450px] md:h-[850px] md:max-h-[calc(100vh-40px)] bg-[#0f172a]/95 backdrop-blur-xl border-none md:border border-slate-700/50 rounded-none md:rounded-3xl shadow-none md:shadow-2xl flex flex-col overflow-hidden overscroll-none touch-none z-[100] origin-bottom-right\"\r\n                        >\r\n                            <ChatHeader onMinimize={() => setIsOpen(false)} />\r\n\r\n                            <ChatMessages\r\n                                messages={displayMessages as any[]}\r\n                                isLoading={isLoading}\r\n                                typingMessage={typingMessage}\r\n                                onImageClick={setSelectedImage}\r\n                                messagesContainerRef={messagesContainerRef}\r\n                                messagesEndRef={messagesEndRef}\r\n                            />\r\n\r\n                            <ChatInput\r\n                                inputValue={inputValue}\r\n                                setInputValue={setInputValue}\r\n                                onSubmit={submitMessage}\r\n                                isLoading={isLoading}\r\n                                isUploading={isUploading} // New prop\r\n                                uploadStatus={uploadStatus} // New prop\r\n                                selectedImages={selectedImages}\r\n                                onFileSelect={handleFileSelect}\r\n                                onVoiceRecorded={handleVoiceRecorded}\r\n                                onScrollToBottom={() => scrollToBottom('smooth')}\r\n                                fileInputRef={fileInputRef}\r\n                            />\r\n                        </motion.div>\r\n                    </>\r\n                )}\r\n            </AnimatePresence>\r\n\r\n            {/* Image Lightbox */}\r\n            <ImageLightbox imageUrl={selectedImage} onClose={() => setSelectedImage(null)} />\r\n        </>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAEA,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;;;AApBA;;;;;;;;;;;;;;;;AAiCe,SAAS;;IACpB,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAC;IACrC,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,yKAAQ,EAAgB;IAElE,OAAO;IACP,MAAM,mBAAmB,IAAA,uKAAM,EAAiB;IAChD,MAAM,eAAe,IAAA,uKAAM,EAAmB;IAE9C,qBAAqB;IACrB,MAAM,YAAY,IAAA,sJAAY;IAE9B,4BAA4B;IAC5B,MAAM,EAAE,aAAa,EAAE,eAAe,EAAE,GAAG,IAAA,0JAAc,EAAC;IAE1D,yBAAyB;IACzB,gEAAgE;IAChE,MAAM,iBAAiB,wKAAK,CAAC,OAAO;8CAAC,IAAM,CAAC;gBACxC,IAAI;gBACJ,MAAM;gBACN,SAAS;YACb,CAAC;6CAAG,EAAE;IAEN,wDAAwD;IACxD,2DAA2D;IAC3D,MAAM,sBAAsB,wKAAK,CAAC,OAAO;mDAAC;YACtC,iEAAiE;YACjE,sDAAsD;YACtD,OAAO,gBAAgB,MAAM,GAAG,IAAI,kBAAkB,EAAE;QAC5D;kDAAG;QAAC;KAAgB;IAEpB,8CAA8C;IAC9C,MAAM,eAAe,IAAA,4IAAO,EAAC,WAAW;IACxC,MAAM,EAAE,QAAQ,EAAE,SAAS,EAAE,MAAM,EAAE,KAAK,EAAE,GAAG;IAE/C,kEAAkE;IAClE,6CAA6C;IAC7C,MAAM,kBAAkB,wKAAK,CAAC,OAAO;+CAAC;YAClC,IAAI,gBAAgB,MAAM,GAAG,GAAG;gBAC5B,OAAO;YACX;YACA,sEAAsE;YACtE,OAAO,SAAS,MAAM,KAAK,IAAI;gBAAC;aAAe,GAAG;QACtD;8CAAG;QAAC,gBAAgB,MAAM;QAAE;QAAU;KAAe;IAErD,kDAAkD;IAClD,kDAAkD;IAClD,MAAM,EAAE,cAAc,EAAE,SAAS,EAAE,gBAAgB,EAAE,WAAW,EAAE,WAAW,EAAE,YAAY,EAAE,GAAG,IAAA,0JAAc,EAAC;IAE/G,oBAAoB;IACpB,MAAM,EAAE,oBAAoB,EAAE,cAAc,EAAE,cAAc,EAAE,GAAG,IAAA,wJAAa,EAAC,gBAAgB,MAAM,EAAE;IAEvG,8BAA8B;IAC9B,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAA,gKAAiB,EAAC,QAAQ;IAE/C,mBAAmB;IACnB,MAAM,gBAAgB,IAAA,kKAAkB,EAAC;IAEzC,cAAc;IACd,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yKAAQ,EAAC;IAE7C,yBAAyB;IACzB,MAAM,gBAAgB,CAAC;QACnB,GAAG;QACH,IAAI,AAAC,CAAC,WAAW,IAAI,MAAM,eAAe,MAAM,KAAK,KAAM,WAAW;QAEtE,IAAI,eAAe,MAAM,GAAG,GAAG;YAC3B,OAAO;gBACH,MAAM;gBACN,SAAS;gBACT,2DAA2D;gBAC3D,aAAa;oBACT,QAAQ,UAAU,MAAM,GAAG,IAAI,YAAY,eAAe,yCAAyC;gBACvG;YACJ,GAAU;gBACN,MAAM;oBACF,QAAQ;oBACR,WAAW,UAAmB,oCAAoC;gBACtE;YACJ;YACA;YACA,cAAc;QAClB,OAAO;YACH,OAAO;gBACH,MAAM;gBACN,SAAS;YACb;YACA,cAAc;QAClB;IACJ;IAEA,0BAA0B;IAC1B,MAAM,sBAAsB,OAAO;QAC/B,IAAI;YACA,4DAA4D;YAC5D,MAAM,WAAW,IAAI;YACrB,SAAS,MAAM,CAAC,SAAS;YAEzB,MAAM,cAAc,MAAM,MAAM,uBAAuB;gBACnD,QAAQ;gBACR,MAAM;YACV;YAEA,IAAI,CAAC,YAAY,EAAE,EAAE;gBACjB,MAAM,IAAI,MAAM;YACpB;YAEA,MAAM,EAAE,MAAM,eAAe,EAAE,GAAG,MAAM,YAAY,IAAI;YAExD,IAAI,mBAAmB,gBAAgB,IAAI,IAAI;gBAC3C,kEAAkE;gBAClE,MAAM,UAAe;oBACjB,MAAM;oBACN,SAAS,CAAC,GAAG,EAAE,iBAAiB;gBACpC;gBAEA,oDAAoD;gBACpD,IAAI,eAAe,MAAM,GAAG,GAAG;oBAC3B,QAAQ,WAAW,GAAG;wBAClB,QAAQ,UAAU,MAAM,GAAG,IAAI,YAAY;oBAC/C;gBACJ;gBAEA,MAAM,OAAO,SAAS;oBAClB,MAAM;wBACF,QAAQ;wBACR,WAAW;oBACf;gBACJ;YACJ,OAAO;gBACH,QAAQ,IAAI,CAAC;YACjB;QACJ,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,0BAA0B;QACxC,wDAAwD;QAC5D;IACJ;IAEA,6DAA6D;IAC7D,IAAA,0KAAS;gCAAC;YACN,MAAM;uDAAiB,CAAC;oBACpB,UAAU;oBACV,IAAI,EAAE,MAAM,EAAE,SAAS;wBACnB;mEAAW;gCACP,OAAO;oCAAE,MAAM;oCAAQ,SAAS,EAAE,MAAM,CAAC,OAAO;gCAAE;4BACtD;kEAAG;oBACP;gBACJ;;YACA,OAAO,gBAAgB,CAAC,0BAAiC;YACzD;wCAAO,IAAM,OAAO,mBAAmB,CAAC,0BAAiC;;QAC7E;+BAAG;QAAC;KAAO;IAEX,mEAAmE;IACnE,kEAAkE;IAClE,IAAI,CAAC,eAAe;QAChB,OAAO;IACX;IAEA,qBACI;;0BAEI,6LAAC;gBAAI,WAAU;;kCACX,6LAAC,oKAAY;wBAAC,QAAQ;wBAAQ,YAAY,IAAM,UAAU;;;;;;kCAC1D,6LAAC,4KAAgB;wBAAC,QAAQ;wBAAQ,SAAS,IAAM,UAAU,CAAC;;;;;;;;;;;;0BAIhE,6LAAC,+MAAe;0BACX,wBACG;;sCAEI,6LAAC,uMAAM,CAAC,GAAG;4BAEP,SAAS;gCAAE,SAAS;4BAAE;4BACtB,SAAS;gCAAE,SAAS;4BAAE;4BACtB,MAAM;gCAAE,SAAS;4BAAE;4BACnB,WAAU;2BAJN;;;;;sCAQR,6LAAC,uMAAM,CAAC,GAAG;4BAEP,SAAS;gCAAE,SAAS;gCAAG,GAAG;gCAAI,OAAO;4BAAK;4BAC1C,SAAS;gCAAE,SAAS;gCAAG,GAAG;gCAAG,OAAO;4BAAE;4BACtC,MAAM;gCAAE,SAAS;gCAAG,GAAG;gCAAI,OAAO;4BAAK;4BACvC,YAAY;gCAAE,UAAU;4BAAI;4BAC5B,KAAK;4BACL,OAAO;gCAAE,QAAQ,WAAW,WAAW;gCAAW,KAAK,WAAW,IAAI;4BAAU;4BAChF,WAAU;;8CAEV,6LAAC,gKAAU;oCAAC,YAAY,IAAM,UAAU;;;;;;8CAExC,6LAAC,oKAAY;oCACT,UAAU;oCACV,WAAW;oCACX,eAAe;oCACf,cAAc;oCACd,sBAAsB;oCACtB,gBAAgB;;;;;;8CAGpB,6LAAC,8JAAS;oCACN,YAAY;oCACZ,eAAe;oCACf,UAAU;oCACV,WAAW;oCACX,aAAa;oCACb,cAAc;oCACd,gBAAgB;oCAChB,cAAc;oCACd,iBAAiB;oCACjB,kBAAkB,IAAM,eAAe;oCACvC,cAAc;;;;;;;2BA/Bd;;;;;;;;;;;;0BAuCpB,6LAAC,sKAAa;gBAAC,UAAU;gBAAe,SAAS,IAAM,iBAAiB;;;;;;;;AAGpF;GA9NwB;;QASF,sJAAY;QAGa,0JAAc;QAmBpC,4IAAO;QAeoE,0JAAc;QAG7C,wJAAa;QAGzD,gKAAiB;QAGhB,kKAAkB;;;KAvDpB"}}]
}